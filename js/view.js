"use strict";define("widget-feedBack-view",["jquery","U","goals/handlers","ul-fileinput","icon-set-loader","aDialog","css!/css/require/emailStatusDialog.css"],function(e,t,n,i,r,a){var o={i18nView:function(){return function(e){return window.cache.feedBack&&window.cache.feedBack.i18n[e]}}(),name:"feedBack-view",isShowCaptcha:!1,files:[],Captcha:{list:{},get:function(){return function(t,n){e.post("/api/captcha",{action:"get"},function(i){if(i[0]||!i[1]||!i[1].url)return void console.log("get captcha error",i[0]);var r=i[1];e("#captcha-"+t.attr("id")).attr("src",r.url),n()})}}(),check:function(){return function(e){e.attr("id")}}(),reset:function(){return function(e){e.attr("id")}}()},opened:!1,errors:{},$getWidget:function(){return function(e){return e.closest(".ul-widget-feedBack")}}(),initI18n:function(){return function(){var e=this;return new Promise(function(t){window.cache.feedBack&&window.cache.feedBack.i18n?t():window.require(["i18n-view"],function(n){e.i18nView=n,t()})})}}(),open:function(){return function(e){var t=this,n=document.getElementById(e);n&&this.initI18n().then(function(){t.init(n)})}}(),initCaptcha:function(){return function(){var t=this;if(window.grecaptcha){var n=e("#js-captchaPublicKey").data("key");n&&e(".ul-w-feedBack-captchare-fuct").each(function(){var i=e(this).attr("id");t.Captcha.list[i]=window.grecaptcha.render(i,{sitekey:n})})}else setTimeout(function(){t.initCaptcha()},1e3)}}(),send:function(){return function(n,i,r){var a=this,o={inputs:[]};e("[ul-model]",n).each(function(){var t=e(this),n=t.attr("ul-model");"inputs"===n.substr(0,6)?o.inputs.push(t.val()):o[n]=t.val()});var c=n.closest(".ul-widget-feedBack").attr("id");if(i=e.extend(!0,i,o),i.inputs){var s=[],u=Object.keys(i.inputs).length-1;u=parseInt(Object.keys(i.inputs)[u]);for(var l=0;u>=l;l++)s.push(i.inputs[l]||"");i.inputs=JSON.stringify(s)}delete i.attachments;var d=new FormData;e.extend(!0,i,{siteUrl:t.params.siteUrl||t.params.site},i);var f=n.attr("action");if(i.isCheck)f=i.url,delete i.url,delete d.isCheck;else{a.files=a.attachmentFile[c].getFileInput();var p=a.files&&Object.keys(a.files).length;if(e(".js-file-input",n).hasClass("required")&&!p)return a.attachmentFile[c].clearInput(),a.attachmentFile[c].clearLabel(),void a.attachmentFile[c].errorMessage(a.i18nView("required field"));p&&e.each(a.files,function(e,t){d.append("attachments",t)})}if(e.each(i,function(e,t){d.append(e,t)}),t.params.isULanding&&!i.isCheck){var m={};window.localStorage&&(m.referrer=localStorage.getItem("firstReferrer")),e.each(n.find("input, textarea"),function(t,n){m[e(n).attr("name")]={value:e(n).val(),hold:e(n).attr("placeholder")}}),e.ajax({url:t.sprintf("/api/stats/lead?site={site}&action=feedback",[t.params.siteUrl||t.params.site]),type:"POST",data:JSON.stringify(m),contentType:"application/json"}).done(function(){}).fail(function(){console.log("lead is false")})}e.ajax({method:"post",url:f,data:d,contentType:!1,processData:!1,success:function(){return function(e){a.clearForm(n),e[0]?a.info(n,"server error",1):r(e[1])}}()})}}(),validateForm:function(){return function(t,n,i){var r=this,a=[],o=new FormData;e("[ul-model]",t).each(function(){var t=e(this),n=t.attr("ul-model");"inputs"===n.substr(0,6)?a.push(t.val()):o.append(n,t.val())}),a.length&&o.append("inputs",JSON.stringify(a));var c=function(){return function(e,t,n){var i=e.find('[ul-model = "'+t+'"]').closest(".ul-widget-feedBack-form-group");n[t]&&"attachments"!==t?(r.errors[t]=!0,i.addClass("has-error"),r.showErrorMsg(e,t,n[t])):(r.errors[t]=!1,i.removeClass("has-error"),r.removeErrorMsg(e,t))}}();e.ajax({method:"post",url:"/api/feedBack/check",data:o,contentType:!1,processData:!1,success:function(){return function(e){if(e[0])return void r.info(t,"server error",1);var a={errors:e[1]?e[1].errors:{},etexts:e[1]?e[1].etexts:{}};if(n){var o=n.attr("ul-model");c(t,o,a.etexts)}else Object.keys(a.etexts).forEach(function(e){c(t,e,a.etexts)});if(a.errors&&a.errors.captcha&&!r.isShowCaptcha){var o=r.$getWidget(t);r.Captcha.get(o,function(){r.isShowCaptcha=!0}),r.clearMessage(t)}Object.values(r.errors).includes(!0)?t.find('button[type="submit"]').prop("disabled",!0):t.find('button[type="submit"]').prop("disabled",!1),i&&i(!Object.values(r.errors).includes(!0))}}()})}}(),init:function(){return function(t){var a=this,o=t.id;if(a.opened||(a.opened=!0),a.$el=e("#"+o),!a.$el||0===a.$el.length)return console.log("el not found"),!1;var c=e("form",a.$el);if(r.loadIconSet("fontAwesome",function(){}),window.constructorMode||window.previewMode||window.wizardTemplatePreviewMode)return void c.on("submit.feedBack",function(e){e.preventDefault()});window.localStorage&&document.referrer&&!localStorage.getItem("firstReferrer")&&localStorage.setItem("firstReferrer",document.referrer);var s=n.getHandlerFunction(a.$el.data("goalsData")),u=e(".ul-w-feedBack-captcha"),l=e(".js-file-input",c);0<u.length&&u.remove(),a.attachmentFile||(a.attachmentFile={});var d=e.extend({maxFilesCount:20,maxFileSize:25},window.cache.feedback);a.attachmentFile[o]=new i({$el:l,allowedMimeTypes:["text/plain","application/pdf","image/jpeg","image/png","image/gif","image/bmp","application/x-zip-compressed","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/sla","application/vnd.ms-pki.stl","application/x-navistyle","application/dxf","image/vnd.dwg","image/x-dwg","application/acad","image/vnd.dwg","image/x-dwg","image/x-coreldraw","image/cdw","application/x-cdt","application/x-cdw",""],i18nView:this.i18nView,specialFileList:!0,id:o,maxFiles:d.maxFilesCount,maxFileSize:1024*(1024*d.maxFileSize),maxSumSize:1024*(1024*d.maxFileSize),selectFile:function(){return function(){}}(),open:function(){return function(){a.errors.attachments=!1,c.find('button[type="submit"]').prop("disabled",!1)}}(),error:function(){return function(){a.errors.attachments=!0,c.find('button[type="submit"]').prop("disabled",!0)}}()}),a.attachmentFile[o].init(),e(".ul-widget-feedBack-form-control[required]",c).on("change",function(){if(/\/uwizard/i.test(window.location.toString()))return!1;var t=e(this);a.validateForm(c,t)}),c.on("submit.feedBack",function(e){e.preventDefault(),a.validateForm(c,null,function(e){e&&a.submitForm(c,s)})});var f=window.location.toString();f.match(/uwizard/)||e.ajax({url:"/api/feedBack/pass",method:"GET",dataType:"json",error:function(){return function(){}}(),success:function(){return function(e){var t='<input type="text" style="display: none;" value="" ul-model="'+e.name+'" name="'+e.name+'">';c.append(t)}}()})}}(),infoTimer:null,submitForm:function(){return function(t,n){var i=this,r=t.closest(".ul-widget-feedBack").attr("id");return!/\/uwizard/i.test(window.location.toString())&&(e('button[type="submit"]').attr("disabled","disabled"),i.send(t,{},function(a){return e('button[type="submit"]').removeAttr("disabled"),a?a.etext?i.info(t,a.etext,1):void(a.ok&&(a.afterMail&&i.info(t,a.afterMail,0),i.clearMessage(t),i.attachmentFile[r].clearInput(),i.attachmentFile[r].clearLabel(),n())):void 0}),!1)}}(),info:function(){return function(t,n,i){a.open({wide:!1,title:"",data:"<h2>"+this.i18nView("widgets.feedBack.name")+'</h2><div class="ul-feedBack-status-dialog">'+n+"</div>",afterOpen:function(){return function(){e(document).trigger("openButtonOrderForm")}}(),beforeClose:function(){return function(){e(document).trigger("closeButtonOrderForm")}}()}),i||t[0].reset()}}(),clearForm:function(){return function(t){e(".ul-w-feedBack-captcha",t).removeClass("has-error"),e(".ul-widget-feedBack-form-group",t).each(function(){e(this).removeClass("has-error")}),e(".ul-widget-feedBack-responce",t).hide().text("")}}(),clearMessage:function(){return function(t){e('[ul-model="message"]',t).val("")}}(),destroy:function(){return function(){e("form").off("submit.feedBack",this.submitForm)}}(),showErrorMsg:function(){return function(t,n,i){var r=t.find('[ul-model = "'+n+'"]').closest(".ul-widget-feedBack-form-group"),a=r.find(".error-msg");a.length||(a=e("<div>",{"class":"error-msg"}),a.appendTo(r)),a.html(i)}}(),removeErrorMsg:function(){return function(e,t){var n=e.find('[ul-model = "'+t+'"]').closest(".ul-widget-feedBack-form-group"),i=n.find(".error-msg");i.length&&i.remove()}}(),parseErrors:function(){return function(t,n){if(t){var i="",r=n?n:Object.keys(t);return r.forEach(function(n){t[n]&&("captcha"===n?e(".ul-w-feedBack-captcha").addClass("has-error"):e('[ul-model = "'+n+'"]').closest(".ul-widget-feedBack-form-group").addClass("has-error"),i+=t[n]+"\n")}),i||!1}return!1}}()};return o});
//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map

//# sourceMappingURL=view.js.map
