"use strict";var _Mathabs=Math.abs,_Mathround=Math.round,_slicedToArray=function(){function e(e,t){var o=[],i=!0,n=!1,r=void 0;try{for(var a,d=e[Symbol.iterator]();!((i=(a=d.next()).done)||(o.push(a.value),t&&o.length===t));i=!0);}catch(s){n=!0,r=s}finally{try{!i&&d["return"]&&d["return"]()}finally{if(n)throw r}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("constructor",["_","jquery","jquery-ui-draggable","U","jquery-ui-resizable-bootstrap","widget","nf","waitall","enqueueAjax","history","lodash","asyncjs","i18n","logActions","linkPopover","constructor/HistoryActions","constructor/construct","constructor/events","constructor/settings","/js/ulib/block-100vh.js","colorThemeHelper","text!/html/constructor/headerFooterControls.html","text!./html/constructor/handlerBlock.html","autocrop","billing/feature-availability","device-canvas","ul-error","panelPartials"],function(e,t,o,i,n,r,a,d,s,l,c,u,g,p,h,f,v,m,w,b,C,k,y,x,S,_,W){var I={isConstructor:!0,activeResize:!1,widgetGlobal:r,inited:!1,lastSessionId:0,STEP_GRID:8.33333333,COLS_LIMIT:12,blockClasses:["ul-container"],blockSettings:{},blocks:null,activeDrag:!1,activeAutocrop:!1,emptyContainerForHistory:{htmlContent:'<div id="UL_ID" class="ul-container"><div class="container js-block-container"></div></div>',widgets:{},content:{}},emptyContainer:{htmlContent:'<div id="UL_ID" class="ul-container"><div class="container js-block-container"><div id="UL_ID" class="row ul-row"><div id="UL_ID" class="ul-col col-md-12 col-xs-12 col-sm-12"></div></div></div></div>',widgets:{},content:{}},emptyContainerFluid:{htmlContent:'<div id="UL_ID" class="ul-container"><div class="container-fluid js-block-container"><div id="UL_ID" class="row ul-row"><div id="UL_ID" class="ul-col col-md-12 col-xs-12 col-sm-12"></div></div></div></div>',widgets:{},content:{}},init:function(){return function(e){var o=this;e||(e=function(){return function(){}}()),o.inited&&o.destroy(),o.lastId=i.params.lastId,o.isTemplateMaster=i.params.isTemplateMaster,o.lastSessionId=0,o.inited=!0,window.UU.history=l,window.UU.widget=r,window.UU.constructor=o,o.resizeDeviceInit||(o.resizeWindowSetDevice(),o.onConstructorDevice(window.UU.constructor.deviceMode.device)),o.isDraggableWidget(window.UU.constructor.deviceMode.isPanelConstructorEditable),i.enqueueAjax=s,i.enqueueAjax.nf=a,u.map(i.params.widgetsIds,function(e,o){var n=window.widgetInfo[e.type].version,a=window.widgetVersion;return n==a.REACT||n==a.REACT_WRAPPER?o():"shop"!==i.params.pageType&&"special"!==i.params.pageType||"cart"!==e.type?t("#"+e.id).attr("data-widget")||"special"===i.params.pageType?void i.widget.factoryWidgetInstance(e.type,{id:e.id,$el:t(document.getElementById(e.id)),field:e.field,data:e.data,options:e.options,controls:e.controls},function(i){i.initView(e.id),r.renderElementControls(t(document.getElementById(e.id))),o()}):o():void o()},function(){i.widget.setWidgetsCollectionFull()}),o.cecutient(),r.init({constructor:o,templateId:i.params.template,site:i.params.site,initWidgetsOnLoad:!0}),t("#ul-content",o.$body).children(".ul-container").length||"blog"===i.params.pageType||t("#ul-content",o.$body).html('<div class="container ul-drop-placeholder"><div class="ul-empty-ingorm"><div class="ul-empty-drag-help"></div> <p>'+g("constructor.Drag elements or block from the left panel")+"</p></div></div>"),"blog"!==i.params.pageType&&t.each(t(".ul-container",o.$body),function(e,o){0==t(o).find(".ul-col").children(".ul-widget").length?(t(o).attr("block-empty",!0),t(o).find(".ul-col").attr("data-description",g("constructor.Drag elements from the left panel"))):void 0==t(o).attr("block-empty")&&t(o).attr("block-empty",!1)}),o.addContainerHandler(t(".ul-container",o.$body)),o.posContainerHandler(),o.addHeaderFooterControll(),o.blocks||t.get("/sites/url/"+i.params.site+"/blocksList",function(e){o.blocks=e}),o._constructorEvents(),setTimeout(function(){o.parallax(),e()},1e3),"blog"!==i.params.pageType&&(t.each(t(".ul-container","#body-fict"),function(){var e=t(this);if("map"===e.attr("data-bgtype")){var i=null,n=t(".js-background-map",e);try{i=JSON.parse(e.attr("data-map-settings"))}catch(r){console.error("map settings JSON parse failed")}if(!i)return;n.length||(n=t('<div class="ul-background-block-map js-background-map"></div>').prependTo(e)),o.addBlockBackgroundMap(i,n)}if("video"===e.attr("data-bgtype")){var a=null,d=t(".ul-background-video-container",e);try{a=JSON.parse(e.attr("data-video-settings"))}catch(r){console.error("video settings JSON parse failed")}if(!a)return;d.length||(d=t('<div class="ul-background-video-container"><div class="ul-background-block-video js-background-video"></div></div>').prependTo(e)),o.addBlockBackgroundVideo(a,d)}}),""===i.params.yandexMapsApiKey&&i.params.yandexMapsApiKeyEnabled&&r.getWidgets(function(e){var o=Object.values(e).filter(function(e){return"maps"===e.type&&"yandex"===e.options.provider}),n=Object.values(e).filter(function(e){return"contacts"===e.type&&e.options.map}),r=t('[data-bgtype="map"][data-map-settings*="yandex"]');if(o.length||n.length||r.length)try{var d="yandexMapsNoticeCounter_"+i.params.site,s=localStorage.getItem(d)||0;if(s=parseInt(s,10),3>s){var l=g("widgets.maps.no api key notice yandex");a.notify(l,"default",{useHtml:!0,timeout:1e4}),t.post("/sites/url/"+i.params.site+"/sendMapsApiNotice"),localStorage.setItem(d,s+1)}}catch(d){console.error("Error with localStorage : ",d)}})),t(document).off(".removeCard").on("pageRemoved.removeCard",function(){o.onProductCardRemoved()}).on("loadedCart.removeCard",function(){0===i.params.shop.productCardsQuantity&&i.params.shop.isActive&&o.__removeWidget(t("#ul-id-cart-0"),e,!0,!1)}),b.init(),o.initReactWidgets()}}(),addHeaderFooterControll:function(){return function(){var o=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=this,r=function(){return function(e){var o=e.find(".ul-widget"),n=function(){return function(e){return JSON.parse(e.attr("data-device-hidden"))}}();return o.toArray().some(function(e){return!0===n(t(e))[i.constructor.deviceMode.device]})}}();t.each(t("header, footer",n.$body),function(n,a){var d=t(e.template(k)({__:g,title:g(t(a).is("header")?"constructor.blocksTypes.header":"constructor.blocksTypes.footer"),type:t(a).is("header"),pageType:i.params.pageType,device:i.constructor.deviceMode.device,hideWidgetDevice:r(t(a))}));o&&t(".ul-headerFooter-controls",t(this)).replaceWith(d),t(".ul-headerFooter-controls",t(this)).length||d.appendTo(t(a)),r(t(a))?t(".ul-headerFooter-handler",t(a)).addClass("ul-headerFooter-handler-has-extra"):t(".ul-headerFooter-handler",t(a)).removeClass("ul-headerFooter-handler-has-extra")})}}(),initReactWidgets:function(){return function(){var e=this;window.signals.openLinkPopover.clear(),window.signals.closeLinkPopover.clear(),window.signals.openImageLib.clear(),window.signals.renderWidgetWrapped.clear(),window.signals.updateWidgetWrapped.clear(),window.signals.openWidgetSettings.clear(),window.signals.closeWidgetSettings.clear(),window.signals.destroyBlock.clear(),window.signals.destroyWidget.clear(),window.signals.showFatal.clear(),window.signals.copyWidget.clear(),window.signals.newHistory.clear(),window.signals.startMovingWidget.clear(),window.signals.movingWidget.clear(),window.signals.stopMovingWidget.clear();var o=null,n=null;window.signals.openLinkPopover.listen(function(e){return new Promise(function(i){o&&e.key===n?o.destroy():o&&(n=null,o.destroy());var r=t.extend({scrollTop:t("#ul-main").scrollTop(),leftContainer:t(e.selector).offset().left},e.rect);n=e.key,o=new h({$target:t(e.selector),rect:r,href:e.url,types:e.types||["outer","inner","orderForm"],type:e.type,newWindow:"_blank"===e.target,gravity:e.gravity,removeBtn:!0,apply:function(){return function(e){window.dispatch(window.actions.applyLink(e.href,e.pageTitle,e.newWindow?"_blank":"_self",e.type))}}()}),o.show({$target:t(e.selector),rect:r,onAfterOpen:function(){return function(){e.url||o._switchPage("edit","inner")}}()}),i()})}),window.signals.closeLinkPopover.listen(function(){return new Promise(function(e){o&&(n=null,o.destroy(),o=null),e()})}),window.signals.openImageLib.listen(function(){return new Promise(function(e){require(["imagelib"],function(t){t.open({multiSelect:!1,apply:function(){return function(t){var o=_slicedToArray(t,1),i=o[0].origin;e(),window.dispatch(window.actions.insertImage(i))}}(),close:function(){return function(){e()}}()})})})}),window.wrapedWidgets=[],window.signals.renderWidgetWrapped.listen(function(e){var o=e.id,n=e.type,r=e.data,a=e.opts;return new Promise(function(e){var d=t("#"+o+"-inner");d.empty(),i.widget.factoryWidgetInstance(n,{id:o,$el:d,controls:"mer"},function(t){r&&(t.data=r,t.synced=!0),a&&(t.options=a),t.addBlockWidget=!1,window.wrapedWidgets[o]=t,t.render(e)})})}),window.signals.updateWidgetWrapped.listen(function(e){var t=e.id,o=e.data,i=e.opts;return new Promise(function(e){var n=window.wrapedWidgets[t];Object.assign(n.data,o),Object.assign(n.options,i),n.render(e)})}),window.signals.showWidgetOverlay.listen(function(e){return new Promise(function(o){require(["widget"],function(i){i.proto.overlay.show({$el:t("#"+e),autohide:!1}),i.proto.overlay.$el.one("click",function(){return window.dispatch(window.actions.exitWidget())}),t("#ul-left-menu").append('\n						<div class="js-fake-panel"\n							style="'+["position: absolute","left: 0","top: 0","width: 100%","height: 100%","z-index: 99"].join("; ")+';"\n						>\n						</div>\n					'),t(".js-fake-panel").one("click",function(){return window.dispatch(window.actions.exitWidget())}),o()})})}),window.signals.openWidgetSettings.listen(function(e){return new Promise(function(o){require(["panelDialog","widget"],function(i,n){n.proto.overlay.show({$el:t("#"+e),autohide:!1}),n.proto.overlay.$el.one("click.overlayEvents",function(){window.dispatch(window.actions.exitWidget())}),i.show({data:"",noScroll:!0}),o()})})}),window.signals.closeWidgetSettings.listen(function(){return new Promise(function(e){require(["panelDialog","widget"],function(o,i){i.proto.overlay.hide();var n=t(".js-fake-panel");n.length?n.remove():o.hide(),e()})})}),window.signals.destroyBlock.listen(function(t,o){return new Promise(function(i){e.__realRemoveBlockWithWidgets.bind(e,o).apply(null,t),i()})}),window.signals.destroyWidget.listen(function(t){return new Promise(function(o){e.__realRemoveWidget.apply(e,t),o()})}),window.signals.showFatal.listen(function(){return new Promise(function(e){window.cache&&(!window.cache||window.cache.isPublished)||/\.[\w]+\/preview\//.test(window.location.href)||t("#iframe-preview").length||(window.analyticsHandler&&[["yandexMetrika.nfErrors","hit",window.location.href],["googleUniversalAnalytics.nfErrors",null,"nfErrors.send","pageview"]].forEach(function(e){window.analyticsHandler.apply(null,e)}),window.constructorMode&&a.confirm({title:g("all.ajaxError.title"),text:g("all.ajaxError.text"),ok:g("all.ajaxError.okBtnText"),okCb:function(){return function(){window.location.reload()}}()})),e()})}),window.signals.copyWidget.listen(function(o,i){return new Promise(function(n){i.$el=t("#"+o),i.controls="mer",i.options=i.opts,delete i.opts,e.copyWidget(i.$el.closest(".ul-row"),i,n)})}),window.signals.newHistory.listen(function(){return new Promise(function(e){l.pushAndExec({act:"newHistory"},e)})}),window.signals.startMovingWidget.listen(function(o){return new Promise(function(n){var r=t("#"+o.id);i.page.startDrop("widget",o.type),e.$body.attr("data-controls","drag"),r.closest(".ul-widget").addClass("ul-el-drag-mask ul-visible-handler"),e.$body.find(".ul-container").css("z-index","auto"),i.menu.$el.css("z-index",1),e.activeDrag=!0,t("html").css("overflow-x","hidden"),t(document).trigger("showDropArea"),n()})});var r;window.signals.movingWidget.listen(function(e){return new Promise(function(t){r=e,i.page.hover(e.x,e.y,"widget",e.type),i.page.autoScrollIframeDragReact(e.y),t()})}),window.signals.stopMovingWidget.listen(function(o){return new Promise(function(n){var a=t("#"+o.id),d=a.closest(".ul-col");if(i.page.stopAutoscroll(),i.menu.$el.css("z-index",""),t("html").css("overflow-x","auto"),e.activeDrag=!1,e.$body.find(".ul-container").css("z-index",""),t(document).trigger("hideDropArea"),a.closest(".ul-widget").removeClass("ul-visible-handler"),!r)return i.page.stopDrop(),n({isRemove:!1});i.page.hover(r.x,r.y,"widget",r.type),r=null,a.closest(".ul-widget").removeClass("ul-el-drag-mask");var s=!1;if(i.page.$dropTarget.hasClass("ul-drop-remove"))s=!0;else{e.dragDrop(a,i.page.$dropTarget,d);var l=a.closest(".ul-row").children();e.setResizeCol(l)}i.page.stopDrop(),e.$body.removeAttr("data-controls"),n({isRemove:s})})})}}(),offAndFadeContainerEdit:function(){return function(e){e.attr("data-offEditAndFade",!0)}}(),onAndFadeContainerEdit:function(){return function(e){e.removeAttr("data-offEditAndFade")}}(),saveRemoveHeaderFooter:function(){return function(o,n,r,a){var d=this;if(a){var s=o.prop("tagName").toLowerCase(),c=n[s]?"addClass":"removeClass";t.ajax({url:"/sites/url/"+i.params.site+"/removeHeaderFooter",method:"PUT",data:{isRemove:n},success:function(){return function(){o[c]("element-"+s+"-removed"),i.params.isRemove[s]=n[s],!r&&n[s]&&t(window).trigger("removeHeaderFooter",s),d.posContainerHandler()}}(),error:function(){return function(e){throw new Error(e)}}()})}else l.pushAndExec({act:"removeHeaderFooter",data:{type:o.prop("tagName").toLowerCase(),"new":{isRemove:e.extend({},n)},old:{isRemove:e.extend({},i.params.isRemove)},isForse:r}})}}(),removeHeaderFooter:function(){return function(e,t){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};p.add({file:"js/edit/constructor.js",title:"removeHeaderFooter"}),this.saveRemoveHeaderFooter(e,t,o.isForse,o.ignoreHist)}}(),restoreHeaderFooter:function(){return function(e,t){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};p.add({file:"js/edit/constructor.js",title:"restoreHeaderFooter"}),this.saveRemoveHeaderFooter(e,t,o.isForse,o.ignoreHist)}}(),moveBlockToSiteBlank:function(){return function(o){require(["text!/html/constructor/blockPreview.html"],function(n){t.ajax({api:!0,type:"post",url:i.sprintf("/api/blanks/site/{site}/page/{page}/moveBlock/{blockId}",[i.params.site,i.params.page,o]),ok:function(){return function(r){var d=i.params.page.replace(/^blocks_/,""),s=d+"_"+o,l=t('.js-block[data-id="'+s+'"]'),c=r.replace(/views/,""),u=e.template(n),g=u({block:{id:s,preview:c+"?v="+Math.random()},key:d});0<l.length?l.replaceWith(g):t('.js-panel-constructor-blocks-list[data-category="'+d+'"]').append(g),a.notify("block move success")}}(),noOk:function(){return function(){a.notify("block move Error","error")}}()})})}}(),addContainerHandler:function(){return function(o){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=this,a={blocks_headers:!0,blocks_content:!0,blocks_thematic:!0,blocks_contacts:!0};setTimeout(function(){var d=["shop:success","shop:checkout","infoPage:userAgreement","infoPage:privacyPolicy"];o.each(function(){var o=this,s=t(this).hasClass("ul-floating"),l=r.getContainerName(t(this)),c=g("constructor.hidden block"),u=!1,p=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.background")},{"class":"settings",event:"settings",title:g("constructor.block-settings.structure")}],[{"class":"copy",event:"copy",title:g("constructor.copy")},{"class":"actions",event:"actions",title:g("constructor.block-settings.actions")},{"class":"cross-big",event:"remove"}]],h=!0;if(~d.indexOf(t(this).data("behavior"))&&(h=!1,p=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.background")}]]),"ul-id-special-404_block"===t(this).attr("id")&&(h=!1,p=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.background")},{"class":"settings",event:"panel",additional:"404"}]]),"desktop"!==i.constructor.deviceMode.device&&i.params.pageIsEditable){p=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.background "+i.constructor.deviceMode.device)},{"class":"eye-close",event:"hide",title:g("constructor.block-settings.hide "+i.constructor.deviceMode.device)},{"class":"eye",event:"hide",title:g("constructor.block-settings.show")},{"class":"undo",event:"restoreWidgets",title:g("constructor.block-settings.restore widgets")}]];var f=function(){return function(){var e=t(o).find(".ul-widget"),n=function(){return function(e){return e.attr("data-device-hidden")?JSON.parse(e.attr("data-device-hidden")):void 0}}();return e.toArray().some(function(e){var o=n(t(e));return o?!0===o[i.constructor.deviceMode.device]:void 0})}}();f()&&(u=!0,t(".ul-block-handler",t(this)).addClass("ul-block-handler-has-extra"))}0==u&&t(".ul-block-handler",t(this)).removeClass("ul-block-handler-has-extra");var v;S.check("customClasses",{showPopupIfNotAvailable:!1},function(e){if(e){var i=t(o).attr("data-custom-classes");try{i&&(v=JSON.parse(i))}catch(n){W.sendErrorOnServer({msg:"Error during data-custom-classes parse",error:n})}}});var m=t(e.template(y)({isTemplateMaster:i.params.isTemplateMaster,isServicePage:a[i.params.page],device:i.constructor.deviceMode.device,hasRestoreButton:u,floatingEnabled:s,controls:p,drag:h,ulContainerName:l,ulContainerHiddenName:c,customClasses:v}));return n?void t(".ul-block-controls",t(this)).replaceWith(m):void(!t(".ul-block-controls",t(this)).length&&m.appendTo(t(this)))})},0)}}(),getContainerName:function(){return function(e){return g(e.find(".ul-widget").length?"ul-id-special-404_block"===e.attr("id")?"constructor.block404":"constructor.block":"constructor.empty block handler name")}}(),posContainerHandler:function(){return function(){var e=i.constructor.deviceMode.device,o=t("header").hasClass("element-header-removed"),n=t("header[data-device-hidden*='\""+e+"\":true']");if(t(".js-first-visible-container").removeClass("js-first-visible-container"),n.length||o){var r=t(".ul-container").first();i.params.isHiddenDeviceBlock||(r=t(".ul-container:not([data-device-hidden*='\""+e+"\":true'])").first()),-1!==r.index()&&(i.params.firstVisibleContainer=r.index(),r.addClass("js-first-visible-container"))}}}(),__addBlock:function(){return function(e,o,n,r,a){var d=this,s=null;n||(n=function(){return function(){}}()),s="block-empty-fluid"===e?d.emptyContainerFluid:"block-empty"===e?d.emptyContainer:"block-empty-for-history"===e?d.emptyContainerForHistory:d.blocks[e];var l=s.htmlContent,c=r?r:d.getId(),p={lastId:d.lastId,lastSessionId:d.lastSessionId},h=c.match(/ul\-id\-(\d+)\-(\d+)/);h[1]=parseInt(h[1]),h[2]=parseInt(h[2]),d.lastId=h[1],d.lastSessionId=h[2],l=l.replace(/UL_ID/g,d.getId.bind(d)),a||(d.lastId=p.lastId,d.lastSessionId=p.lastSessionId),t("#ul-content").find(".ul-drop-placeholder").length&&t("#ul-content").find(".ul-drop-placeholder").remove();var f=d._addBlock(l,t("#ul-content"),o);if(void 0===f.attr("data-device-hidden")&&f.attr("data-device-hidden",JSON.stringify({desktop:!1,tablet:!1,phone:!1})),f.addClass("hidden-elements-device"),f.addClass("js-hidden-device-element"),f.attr("data-device-hidden")||f.attr("data-device-hidden",'{"desktop":false,"phone":false,"tablet":false}'),f.attr("data-behavior")||f.attr("data-behavior","none"),f.attr("data-options")||f.attr("data-options",s.content.params?JSON.stringify(s.content.params):"{}"),f.attr("id")&&s.content.params)d.setBlockSettingsBackground(f.attr("id"),s.content.params),d.setBlockSettingsStructure(f.attr("id"),s.content.params);else if("block-empty"===e||"block-empty-fluid"===e&&f.attr("id")&&!s.content.params){var v=t("#body-fict").attr("data-block_theme"),m=C.getBlockTheme("",v),w="";m.split(" ").includes("g-theme-block-0")&&(w=m.split(" ")[1]),i.params.pages.find(function(e){return e.id===i.params.pageId})._id,w=w||"g-theme-block-1","g-theme-block-5"===v&&(w="g-theme-block-0");var b={desktop:w,tablet:w,phone:w};f.addClass(C.getBlockTheme("",v)).attr("data-theme","g-theme-block-0").attr("data-theme-block",JSON.stringify(b)),b.desktop={theme:w,transparent:!0,background:{overlay:{color:"transparent",opacity:.25}}},d.updateParamsBackgroundState(f.attr("id"),b.desktop,"desktop",!0)}return u.mapSeries(f.find(".ul-widget").toArray(),function(e,o){var i=t(e),n=i.data("id"),r=i.closest(".ul-col"),a=i.data("widget"),l=i.attr("id");i.remove(),d.__addWidget({id:l,noSave:!0,dropId:r.attr("id"),widgetType:a,data:s.widgets[n].data,options:s.widgets[n].opts,blockAdd:!0,autocrop:!1,index:0},o())},function(){d.save({act:"addBlock",blockId:e,index:o,lastId:h[1],lastSessionId:h[2]}),n()}),("block-empty"==e||"block-empty-fluid"==e)&&(f.find(".ul-col").attr("data-description",g("constructor.Drag elements from the left panel")),f.attr("block-empty",!0),f.attr("data-auto_height",!0),f.attr("data-is-100vh-enabled",!1),f.attr("data-custom-classes","[]")),d.addContainerHandler(f),f.index()<=i.params.firstVisibleContainer&&d.posContainerHandler(),t(window).trigger("addElelment"),f}}(),addBlock:function(){return function(e,t,o){var i=this;return p.add({fromFile:"js/edit/constructor.js",title:"addBlock",desc:"addBlock: "+e}),l.pushAndExec({act:"addBlock",data:{id:i.getId(),blockId:e,index:t}},o)}}(),__copyBlock:function(){return function(e,o,n){var a=this,d=t("#"+e.originalId);a.destroyResizable(d);var s=d.clone();t.each(s.find(".ul-widget"),function(){t(this).empty()}),s.removeAttr("block-empty"),s.removeAttr("data-auto_height"),s.removeClass("ui-draggable").find(".ul-block-controls-visible").removeClass("ul-block-controls-visible"),d.removeClass("ui-draggable").find(".ul-block-controls-visible").removeClass("ul-block-controls-visible").find('.js-block-btn[data-event="copy"]').trigger("mouseleave");var l=s.prop("outerHTML").replace(/\n/gim,"");s.remove();var c=e.id?e.id:a.getId(),g={lastId:a.lastId,lastSessionId:a.lastSessionId},p=c.match(/ul\-id\-(\d+)\-(\d+)/);p[1]=parseInt(p[1]),p[2]=parseInt(p[2]),a.lastId=p[1],a.lastSessionId=p[2],l=l.replace(/ul-id-(\d+)-(\d+)/g,function(){return a.getId()}),n||(a.lastId=g.lastId,a.lastSessionId=g.lastSessionId);var h=a._addBlock(l,t("#ul-content"),e.index),f=0;return u.map(h.find(".ul-widget").toArray(),function(e,o){var i=t(e),n=i.attr("id"),s=t(d.find(".ul-widget").toArray()[f]).attr("id"),l=r.get(s),c=i.closest(".ul-col").attr("id");++f,i.remove();var u=l.type,g={},p={};t.extend(!0,g,l.data),t.extend(!0,p,l.options),a.isSingleWidgetPage(u)&&(u="spacer",g={},p={});var h=0;t.each(l.$el.parent().children(".ul-widget"),function(e){h=e}),a.__addWidget({id:n,noSave:!0,dropId:c,widgetType:u,data:g,options:p,index:h,autocrop:!1,blockAdd:!0},function(){o()})},function(){a.copy=!1,a.save({act:"copyBlock",originalId:e.originalId,index:e.index,id:e.id||h.attr("id"),lastId:p[1],lastSessionId:p[2]}),h.offset().top+t("#ul-main").scrollTop()+h.height()>t(window).height()+t("#ul-main").scrollTop()&&t("#ul-main").animate({scrollTop:h.offset().top+t("#ul-main").scrollTop()-(t("#ul-main").offset().top+37)}),a.addContainerHandler(h),h.index()<=i.params.firstVisibleContainer&&a.posContainerHandler(),t(window).trigger("addElelment"),o()}),h}}(),__lockBlock:function(){return function(e,o,i){var n=t("#"+e);if(!n.length)return n;var r=n.find(".js-block-lock");return o&&!r.length?(n.css("overflow","hidden"),n.append('<div class="js-block-lock ul-block-lock"></div>')):!o&&r.length&&(r.remove(),n.css("overflow","")),i(),n}}(),lockBlock:function(){return function(e,t,o){var i=e.attr("id");return p.add({file:"js/edit/constructor.js",title:"lockBlock"}),l.pushAndExec({act:"lockBlock",data:{id:i,isLocked:t}},o)}}(),copyBlock:function(){return function(e,t){var o=this;return o.copy=!0,p.add({file:"js/edit/constructor.js",title:"copyBlock"}),l.pushAndExec({act:"copyBlock",data:{id:o.getId(),blockId:"blockId",originalId:e.attr("id"),index:e.index()+1}},t)}}(),createBlockFromBlockJSON:function(){return function(e,t){return p.add({file:"js/edit/constructor.js",title:"createBlockFromBlockJSON"}),l.pushAndExec({act:"createBlockFromBlockJSON",data:this.generateBlockIds(e)},t)}}(),generateBlockIds:function(){return function(e){var t=this,o=function(){return function(e){return"UL_ID"===e?t.getId():e}}();return e.block.id=o(e.block.id),e.block.rows.map(function(e){e.id=o(e.id),e.cols.map(function(e){e.id=o(e.id),e.widgets.map(function(e){e.id=o(e.id)})})}),e}}(),generateBaseBlockHTML:function(){return function(e){var o="",i=this,n=t("#ul-content"),r=e.block.classes?e.block.classes.slice():[],a=[];r.push("ul-container hidden-elements-device js-hidden-device-element",e.block.params.theme),o=t("<div>",{id:e.block.id,"class":r.join(" "),"data-theme":e.block.params.theme,"data-options":JSON.stringify(e.block.params),"data-auto_height":e.block.params.justifyHeight,"data-parallax":e.block.params.background.parallax,"data-device-hidden":'{"desktop":false,"phone":false,"tablet":false}'}),t(".ul-drop-placeholder",n).length&&t(".ul-drop-placeholder",n).remove();var d=i._addBlock(t(o).get(0),n,e.index||0);"parallax"===e.block.params.background.parallax&&t('<div class="ul-background-block-image-section"><div class="ul-background-block-image-section-inner"><div class="ul-background-block-image js-background-parallaximage parallax"></div></div></div>').appendTo(d);var s=t("<div>",{"class":(e.block.params.fluid?"container-fluid ":"container ")+"js-block-container"}).appendTo(d);return e.block.params.offset||s.addClass("ul-container-no-padding"),this.setBlockSettingsBackground(d.attr("id"),e.block.params),this.setBlockSettingsStructure(d.attr("id"),e.block.params),e.block.rows.forEach(function(e,t){var o=i._addRow(e.id,s,t);e.cols.forEach(function(e,t){e.$el=i._addCol(e.id,o,t,!1),e.widgets.map(function(e,t){return e.__index=t,e}),a.push(e)})}),{cols:a,$container:s,$block:d}}}(),_createBlockFromBlockJSON:function(){return function(o,n){var r,a=this,d=this.generateBaseBlockHTML(o),s=d.$container;return r=function(){return function(e,t,o,i){"productCard"===e.type&&(e.data=null),a.__addWidget({id:e.id,noSave:!0,noColSizeSmartAdjust:!0,dropId:t.id,widgetType:e.type,data:e.data,options:e.opts,index:e.__index,blockAdd:!0},function(){a._setColSize(o,null,t.size),i()})}}(),u.each(d.cols,function(e,t){u.each(e.widgets,function(t,o){a.isSingleWidgetPage(t.type)&&(t.type="spacer",t.data={},t.opts={}),"customHtml"===t.type?S.check("customHtml",{showPopupIfNotAvailable:!1},function(i){i||(t.data.code=""),r(t,e,e.$el,o)}):r(t,e,e.$el,o)},function(e){return e?void console.error(e):void t()})},function(r){if(r)return void console.error(r);a.save({act:"createBlockFromBlockJSON",data:e.extend({},o,{index:o.index||0,lastId:a.lastId,lastSessionId:a.lastSessionId})}),a.addContainerHandler(d.$block),d.$block.index()<=i.params.firstVisibleContainer&&a.posContainerHandler(),t(window).trigger("addElelment");var l=t("#ul-main");s.offset().top+l.scrollTop()+s.height()>t(window).height()+l.scrollTop()&&l.animate({scrollTop:s.offset().top+l.scrollTop()-(l.offset().top+37)}),n&&n()}),s}}(),__addCol:function(){return function(e,o,i,n){var r,a=this,d={act:"addCol",to:e.hasClass("ul-row")?e.attr("id"):e.parent().attr("id"),id:n?n:a.getId(),index:o};return n.match(/special/)?!!r&&t('<div id="'+d.id+'" class="ul-col ul-absolute-widgets"></div>').appendTo(t("#ul-main #body-fict")):(r=a._addCol(d.id,e,o,i),!!r&&(a.save(d),r))}}(),addCol:function(){return function(e,o,i){var n=this,r=n.getId(),a=e.attr("id"),d=a,s=n._dumpColSizesOfRow(t("#"+d));return p.add({fromFile:"js/edit/constructor.js",title:"addCol",desc:"id: "+r}),l.pushAndExec({act:"addCol",data:{id:r,dropId:a,rowId:d,colSizes:s,index:o,moveWidget:i}})}}(),__addRow:function(){return function(e,t,o){var i=this,n={act:"addRow",to:e.closest(".ul-container").attr("id"),id:o?o:i.getId(),index:t},r=i._addRow(n.id,e,t);return i.save(n),r}}(),addRow:function(){return function(e,t){var o=this,i=o.getId(),n=e.attr("id");return p.add({fromFile:"js/edit/constructor.js",title:"addRow",desc:"id: "+i}),l.pushAndExec({act:"addRow",data:{id:i,dropId:n,ulContainerId:e.closest(".ul-container").attr("id"),index:t}})}}(),__addWidget:function(){return function(e,o,n){var r=this;if(!e.dropId)return!1;var a=t("#"+e.dropId);if(0===a.length&&!e.dropId.match(/special/))return!1;if(!a.hasClass("ul-absolute-widgets")&&(void 0!=a.attr("data-description")&&void 0!=a.closest(".ul-container").attr("block-empty")||0!=a.closest(".ul-container").attr("block-empty")&&"false"!=a.closest(".ul-container").attr("block-empty"))&&(a.removeAttr("data-description"),a.closest(".ul-container").children(".ul-block-controls").find(".ul-block-title").text(g("constructor.block")),!_.getBlockSetting(a.closest(".ul-container").attr("id"),i.constructor.deviceMode.device))){var d=C.getBlockTheme("",t("#body-fict").attr("data-block_theme"));r.setBlockSettingsBackground(a.closest(".ul-container").attr("id"),{theme:d,background:{overlay:""}})}var s={act:"addWidget",to:a.attr("id"),id:e.id,index:e.index,widget:e.widgetType,noSave:e.noSave};if(a.hasClass("ul-absolute-widgets")){s.act="addAbsWidget";var l=null;l=a.hasClass("ul-position-absolute-bottom")?"bottom":a.hasClass("ul-position-absolute-center")?"center":a.hasClass("ul-position-absolute-top")?"top":"special",s.data={party:a.data("position"),position:l}}var c;if(window.widgetInfo[e.widgetType].version==window.widgetVersion.REACT||window.widgetInfo[e.widgetType].version==window.widgetVersion.REACT_WRAPPER){var d=2,u=function(){return function(){d--,0==d&&e.forceSave&&window.dispatch(window.actions.silentSaveWidget(s.id))}}();c=r._addReactWidget(s.id,s.widget,a,e.index),c.attr("data-device-hidden",JSON.stringify({desktop:!1,tablet:!1,phone:!1})),s.noSave||r.save(s,u),o=o||function(){};var p=function(){return function(){r._smartAdjustColSizesOfRow({$row:c.closest(".ul-row"),autocrop:e.notSmartAdj?!e.notSmartAdj:e.autocrop,cb:o})}}();return setTimeout(function(){e.noColSizeSmartAdjust?o&&o():p&&p(),window.dispatch(window.actions.createWidget(r.formatWidgetDataToReact(e))),u()},0),c}return c=r._addWidget(s.id,s.widget,a,e.index),s.noSave||r.save(s),i.widget.factoryWidgetInstance(s.widget,{id:s.id,$el:c,controls:"mer"},function(i){if(e.data&&(i.data=e.data,i.synced=!0),e.options&&(i.options=e.options),e.forceSave&&i.save(),i.addBlockWidget=!!e.blockAdd&&e.blockAdd,a.hasClass("ul-absolute-widgets"))i.render(function(){o&&o(i)});else{o||(o=function(){return function(){}}());var d=function(){return function(t){r._smartAdjustColSizesOfRow({$row:t.$el.closest(".ul-row"),autocrop:e.notSmartAdj?!e.notSmartAdj:e.autocrop,cb:o})}}();i.render(function(){if("imagezoom"===i.type&&!1!==(e.notSmartAdj?!e.notSmartAdj:e.autocrop))if(n)if(2>a.closest(".ul-row").find(".ul-col").length)x.setHeight(i.$el,400);else{var s=a.closest(".ul-row").height(),l=a.find(".ul-widget");l.outerHeight(function(e,t){s-=t},!0),1<l.length&&"false"==a.closest(".ul-container").attr("data-auto_height")&&(s+=i.$el.outerHeight(!0)/2),x.setHeight(i.$el,200>s?200:s>700?700:s)}else x.setHeight(i.$el,"auto"),x.setImmediate(i.$el);"productCard"===e.widgetType?r.onProductCardAdded(d,i):e.noColSizeSmartAdjust?o&&o(i):d&&d(i),t(window).trigger("addElelment")})}}),"addAbsWidget"==s.act&&t(window).trigger("absWidget",{active:!1,wtype:s.widget}),e.isSingleWidget&&(r.singleWidgets.push(s.widget),t(window).trigger("singleWidget",{active:!1,wtype:s.widget})),c}}(),onProductCardRemoved:function(){return function(e){var o=this;e=e?e:function(){},0===i.params.shop.productCardsQuantity?i.params.shop.isActive&&o.__removeWidget(t("#ul-id-cart-0"),e,!0,!1):e()}}(),onProductCardAdded:function(){return function(e,o){var n=this;e=e||function(){},i.params.shop.productCardsQuantity++,i.params.shop.isActive||(i.params.shop.isActive=!0,i.params.isShopPagesLoadNeeded=!0,t(window).trigger("shopCreated")),r.widgetsCollection["ul-id-cart-0"]?(e(o),t(document).trigger("draggableWidgetDisabled",["productCard",!1])):n.__addWidget({widgetType:"cart",id:"ul-id-cart-0",isSingleWidget:!1,noColSizeSmartAdjust:!1,index:0,dropId:"special-7"},function(){
e(o),t(document).trigger("draggableWidgetDisabled",["productCard",!1])})}}(),__copyWidget:function(){return function(e,o){var n=this;if(!e.dropId)return!1;o=o||function(){};var r=t("#ul-main"),a=t("#body").attr("data-controls");t("#body").attr("data-controls","drag");var d=t("#"+e.dropId),s={act:"copyWidget",to:d.attr("id"),id:e.id,index:e.index,widget:e.widgetType,originalId:e.originalId,noSave:e.noSave,controls:e.controls},l=void 0;if(window.widgetInfo[e.widgetType].version){l=n._addReactWidget(s.id,s.widget,d,e.index),l.attr("data-device-hidden",JSON.stringify({desktop:!1,tablet:!1,phone:!1})),s.noSave||n.save(s);var c=function(){return function(){n._smartAdjustColSizesOfRow({$row:l.closest(".ul-row"),cb:o})}}();return c&&c(),t.each(t("#"+e.originalId).closest(".ul-row").find(".ul-widget"),function(){t(this).css({overflow:""})}),l.closest(".ul-row").offset().top+r.scrollTop()+l.closest(".ul-row").height()>t(window).height()+r.scrollTop()&&t("#ul-main").animate({scrollTop:l.closest(".ul-row").offset().top+r.scrollTop()-(r.offset().top+37)},300),t("#body").removeAttr("data-controls"),"edit"===a&&t("#body").attr("data-controls","edit"),window.dispatch(window.actions.createWidget(n.formatWidgetDataToReact(e))),l}return l=n._addWidget(s.id,s.widget,d,e.index),s.noSave||n.save(s),i.widget.factoryWidgetInstance(s.widget,{id:s.id,$el:l,controls:e.controls},function(i){"productCard"==i.type&&delete e.data,e.data&&(i.data={},t.extend(!0,i.data,e.data),i.synced=!0),e.options&&(i.options={},t.extend(!0,i.options,e.options));var d=function(){return function(e){n._smartAdjustColSizesOfRow({$row:e.$el.closest(".ul-row"),cb:o})}}();i.render(function(){var o=t("#"+e.originalId);"productCard"===e.widgetType?n.onProductCardAdded(d,i):(d&&d(i),x.setHeight(i.$el,o)),t.each(o.closest(".ul-row").find(".ul-widget"),function(){t(this).css({overflow:""})}),i.$el.closest(".ul-row").offset().top+r.scrollTop()+i.$el.closest(".ul-row").height()>t(window).height()+r.scrollTop()&&t("#ul-main").animate({scrollTop:i.$el.closest(".ul-row").offset().top+r.scrollTop()-(r.offset().top+37)},300),t("#body").removeAttr("data-controls"),"edit"===a&&t("#body").attr("data-controls","edit")})}),"addAbsWidget"==s.act&&t(window).trigger("absWidget",{active:!1,wtype:s.widget}),n.isSingleWidget(s.widget)&&(n.singleWidgets.push(s.widget),t(window).trigger("singleWidget",{active:!1,wtype:s.widget})),l}}(),checkSizeColCopy:function(){return function(e,o){var i=this,n=0,r=!1,a=i.widgetGlobal.minColsTable[o]||2;return e.closest(".ul-row").children(".ul-col").each(function(e,o){var r=t(o);n+=i._getMinCols(r)}),n+a>12&&(r=!0),r}}(),copyWidget:function(){return function(e,o,n){var r=this;if("true"!=o.$el.attr("data-single-widget")&&!o.$el.parent().hasClass("ul-absolute-widgets")){var a=o.$el.hasClass("ul-widget")?o.$el.attr("data-widget")||o.type:null,d=o.$el.closest(".ul-col").index()+1,s=e;if(null!=a){var c=r.checkSizeColCopy(s,a);c&&(d=s.index()+1,s=s.parent()),t.each(o.$el.closest(".ul-row").find(".ul-widget"),function(){t(this).css({overflow:"hidden"})}),p.add({fromFile:"js/edit/constructor.js",title:"copyWidget",desc:"id: "+o.$el.attr("id")+" widgetType: "+o.type}),r.eq=d,i.history.asAtomic(function(){var e=r.dropWrapWidget({$drop:s,index:d});return l.pushAndExec({act:"copyWidget",data:{id:r.getId(),originalId:o.$el.attr("id"),noSave:!1,dropId:e.drop.attr("id"),widgetType:o.type,data:o.data,options:o.options,index:e.index,controls:o.controls}},n)})}}}}(),addWidget:function(){return function(e,o){var i=this;return void 0==e.$drop||0==e.$drop?!1:(e.id=i.getId(),e.dropId=e.$drop.attr("id"),e.$drop.hasClass("ul-absolute-widgets")||(void 0==e.$drop.attr("data-description")||void 0==e.$drop.closest(".ul-container").attr("block-empty"))&&0==e.$drop.closest(".ul-container").attr("block-empty")||(e.flBlockWasEmpty=!0),e.$drop.hasClass("ul-absolute-widgets")&&(e.id="ul-id-"+e.widgetType+"-0"),delete e.$drop,"productCard"===e.widgetType&&t(document).trigger("draggableWidgetDisabled",["productCard",!0]),p.add({fromFile:"js/edit/constructor.js",title:"addWidget",desc:"id: "+e.id+" widgetType: "+e.widgetType}),l.pushAndExec({act:"addWidget",data:e},o))}}(),dropWrapWidget:function(){return function(e){var t=this;return t.eq=e.index,e.$drop?i.page.deny?(i.page.deny=!1,!1):(e.$drop.hasClass("ul-col")&&0<e.$drop.children(".ul-widget").length&&t.widgetStartResize(e.$drop),e.$drop.hasClass("ul-absolute-widgets")&&0==e.index&&t.addCol(e.$drop,e.index),e.$drop.hasClass("ul-col")&&0==e.$drop.children().length&&void 0!=e.$drop.attr("data-description")&&(e.$drop=e.$drop.parent()),e.$drop.find(".ul-col").length&&0==e.$drop.find("ul-col").children().length&&void 0!=e.$drop.find(".ul-col").attr("data-description")&&(e.$drop=e.$drop.find(".ul-col")),e.$drop.hasClass("ul-col")&&0==e.$drop.children(".ul-widget").length?{drop:e.$drop,index:0}:("ul-content"==e.$drop.attr("id")&&(e.$drop.find(".ul-drop-placeholder").remove(),e.$drop=t.addBlock("block-empty",e.index),t.widgetStartResize(e.$drop.find(".ul-col")),e.$drop=e.$drop.find(".ul-col")),e.$drop.hasClass("container")||e.$drop.hasClass("container-fluid")?(e.$drop=t.addRow(e.$drop,e.index),e.index=0,t.widgetStartResize(e.$drop),e.$drop=t.addCol(e.$drop,e.index)):e.$drop.hasClass("ul-row")&&(t.widgetStartResize(e.$drop),e.$drop=e.moveWidget?t.addCol(e.$drop,e.index,!0):t.addCol(e.$drop,e.index),e.index=0),p.add({fromFile:"js/edit/constructor.js",title:"dropWrapWidget",desc:"index: "+e.index}),{drop:e.$drop,index:e.index})):{drop:e.$drop,index:e.index}}}(),dragGetHelper:function(){return function(e){var o=t('<div class="ul-el-drag-helper "></div>'),i=e.width(),n='<div style="position: absolute; top: 0; left: 0; height: 100%; width: 100%;">';return e.hasClass("ul-widget")?(e.find("iframe").length&&e.hasClass("ul-w-ecwid")?o.append(t("iframe",e).contents().find("html").clone(!1)).append(n).append(e.find(".ul-elements-controls").clone(!0)).css("background-color","white"):e.find("iframe").length&&e.hasClass("ul-widget-twitterLikeBox")?(o.append(t("iframe",e).contents().find("#put-embed iframe").contents().find("html").clone(!1)).append(n).append(e.find(".ul-elements-controls").clone(!0)),o.find("html").css("max-width",Math.floor(t("iframe",e).outerWidth())).css("margin","0 auto")):e.find("iframe").length&&e.hasClass("ul-widget-socialGroups")?o.append(t("iframe",e).contents().find("#put-embed").clone(!1)).append(n).append(e.find(".ul-elements-controls").clone(!0)).css("text-align","center"):o.append(e.clone(!0).attr("id","ul-drag-fakeId")),o.find(".ul-elements-controls").addClass("ul-elements-controls-dragging")):(o.append(e.clone(!0)),o.children(".ul-container").addClass("ul-dragin-helper").height(e.height()),o.find(".ul-block-controls").addClass("ul-block-controls-dragging")),o.css({width:i,height:0==e.height()?50:e.height(),position:"fixed","z-index":9999}),o}}(),getDragParam:function(){return function(e,o,i){var n=this,r={handle:"widget"==i||"absWidget"==i?".ul-elements-handler":".ul-block-handler",cancel:".ui-resizable-handle, .ul-elements-controls-btns, .js-block-btn, .ul-elements-controls-nodrag, .ul-block-handler-no-drag",scroll:!1,iframeFix:!0,appendTo:e.parent(),helper:function(){return function(){return n.dragGetHelper(t(this))}}()};return"absWidget"==i&&(r.helper="origin"),r}}(),repositionAbsWidget:function(){return function(){t('.ul-position-absolute-center[data-position="right"]:not(.ul-w-move)',"#ul-main").css("right",i.getScrollWidth()),t('.ul-position-absolute-top[data-position="right"]:not(.ul-w-move)',"#ul-main").css("right",i.getScrollWidth()+18)}}(),getPosDragElCoord:function(){return function(e,t,o,n,r){var a={},d=0;return null==i.page.$dropTarget||i.page.$dropTarget.hasClass("ul-drop-remove")?null!=i.page.$dropTarget&&i.page.$dropTarget.hasClass("ul-drop-remove")&&(t.attr("data-position",i.page.position).attr("data-party",i.page.$dropTarget.attr("data-position")),t.children(".ul-widget").length&&t.children(".ul-widget").attr("data-party","bottom"),"bottom"===n?(a.left=_Mathround(e.pageX-(o.halfWidth-o.offsetX)),a.top=_Mathround(e.pageY)):(d=2*(("right"===r?-1:0)*o.halfWidth),a.top=_Mathround(e.pageY-o[n].dragOffsetY),a.left=_Mathround(e.pageX-o[n].dragOffsetX+d))):(t.attr("data-position",i.page.position).attr("data-party",i.page.$dropTarget.attr("data-position")),t.children(".ul-widget").length&&t.children(".ul-widget").attr("data-party",i.page.$dropTarget.attr("data-position")),"center"==n||"special"==n?(i.page.$dropTarget.attr("data-position")!==r&&(d=2*(("right"===i.page.$dropTarget.attr("data-position")?1:-1)*o.halfWidth)),a.top=_Mathround(e.pageY-o[n].dragOffsetY),a.left=_Mathround(e.pageX-o[n].dragOffsetX+d)):"bottom"==i.page.position?(a.left=_Mathround(e.pageX-(o.halfWidth-o.offsetX)),a.top=_Mathround(e.pageY)):("center"==i.page.position||"special"==i.page.position)&&(a.left=_Mathround("right"==i.page.$dropTarget.attr("data-position")?e.pageX-o.halfWidth+o.halfHeight:e.pageX-o.halfWidth-o.halfHeight),a.top=_Mathround(e.pageY))),a}}(),dragEl:function(){return function(e,o,n,a){var d=this;if(!a)return!1;var s=null,l={},c={};("widget"==a||"absWidget"==a)&&(l=r.get(e.attr("id"))),"absWidget"==a&&(s=e.parent().clone(!0),s.children(".ul-widget").remove(),s.removeAttr("style"),e=e.parent(),c.offsetX=e.children(".ul-widget").offset().left,c.offsetY=e.children(".ul-widget").offset().top);var u,g,h=d.getDragParam(e,o,a);e.draggable(h,{start:function(){return function(o,n){if("undefined"==typeof l)return!1;if(d.$body.find(".ul-container").css("z-index","auto"),i.menu.$el.css("z-index",1),t(".js-back-click").attr("data-type-block")&&t(".ul-disabled-overlay").trigger("click.constructor"),d.$body.attr("data-controls","drag"),d.activeDrag=!0,t("html").css("overflow-x","hidden"),i.constructor.deviceMode.isPanelConstructorEditable&&t(document).trigger("showDropArea"),"absWidget"==a)t("#body").attr("data-drag-type","fixed"),u=t(this).children(".ul-widget").data("position"),g=t(this).children(".ul-widget").data("party"),n.helper.css({width:n.helper.children(".ul-widget").outerWidth(),height:n.helper.children(".ul-widget").outerHeight()}),s=s.appendTo("#ul-main #body-fict"),d.repositionAbsWidget(),t(this).addClass("ul-w-move").addClass("js-draging").find(".ul-elements-controls").addClass("ul-elements-controls-dragging").closest(".ul-absolute-widgets").css({zIndex:400}).addClass("ul-el-abs-drag-mask"),t("#ul-left-menu").css("zIndex",1),n.helper&&!n.helper.hasClass("ul-abs-animate")&&n.helper.addClass("ul-abs-animate"),n.helper.parent().addClass("ul-el-abs-drag-mask"),l._fetchDataOptions(),c.halfWidth=n.helper.children(".ul-widget").outerWidth()/2,c.halfHeight=n.helper.children(".ul-widget").outerHeight()/2,c.center={dragOffsetX:o.pageX-c.offsetX,dragOffsetY:o.pageY-(c.offsetY+c.halfHeight)},c.special={dragOffsetX:o.pageX-c.offsetX,dragOffsetY:o.pageY-c.offsetY},c.offsetX=c.offsetX+c.halfWidth-o.pageX,c.offsetY=c.offsetY+c.halfHeight-o.pageY;else{n.helper.addClass("ul-el-drag-helper-scale");var r=t(this).offset();n.helper.css({"-webkit-transform-origin":o.pageX-r.left+"px "+(o.pageY-r.top)+"px 0","transform-origin":o.pageX-r.left+"px "+(o.pageY-r.top)+"px 0"}),t(this).closest(".ul-widget").addClass("ul-el-drag-mask")}"block"==a&&e.addClass("ul-el-drag-mask"),i.page.startDrop(a,l.type),p.add({fromFile:"js/edit/constructor.js",title:"startDragEl",desc:"element Id: "+e.attr("id")+" widgetType: "+l.type})}}(),drag:function(){return function(e,o){"absWidget"==a?o.position=d.getPosDragElCoord(e,t(this),c,u,g):i.page.autoScrollIframeDrag(e),i.page.hover(e.clientX,e.clientY,a,l.type)}}(),stop:function(){return function(o,r){"absWidget"==a?t("#ul-left-menu").css("zIndex",""):i.page.stopAutoscroll(),d.$body.find(".ul-container").css("z-index",""),i.menu.$el.css("z-index",""),d.$body.removeAttr("data-controls"),t(this).removeClass("ul-w-move"),t(".ul-block-dragOver").removeClass("ul-block-dragOver"),t("html").css("overflow-x","auto"),d.activeDrag=!1;var c=!1,u=t(this).hasClass("ul-widget")?t(this).closest(".ul-widget"):t(this);if((i.page.$dropTarget.is("footer")||i.page.$dropTarget.is("header")||i.page.$dropTarget.hasClass("ul-el-drag-mask"))&&(c=!0,"absWidget"!=a&&(u.removeClass("ul-el-drag-mask"),t(".ul-widget-hovered").removeClass("ul-widget-hovered"))),!c)if("absWidget"==a)e.parent().removeClass("js-dragging"),t(this).parent().removeClass("ul-el-abs-drag-mask"),l.data.position=i.page.position,t(this).removeClass("js-draging").removeClass("ul-el-abs-drag-mask").removeAttr("style").attr("data-position",s.attr("data-position")).removeAttr("data-party"),0<i.page.$dropTarget.children(".ul-widget").length&&i.page.$dropTarget.attr("id")!=u.attr("id")?d.removeWidget(i.page.$dropTarget.children(".ul-widget"),function(){d.dragDrop(u.children(".ul-widget"),i.page.$dropTarget,n)},200):d.dragDrop(u.children(".ul-widget"),i.page.$dropTarget,n),s.remove(),d.repositionAbsWidget();else{u.removeClass("ul-el-drag-mask"),t(window).trigger("endDragEl",e.attr("id")),d.dragDrop(u,i.page.$dropTarget,n),u.hasClass("ul-widget")&&t(".ul-widget-hovered").removeClass("ul-widget-hovered");var g=u.closest(".ul-container");i.page.$dropTarget.hasClass("ul-drop-remove")||g.addClass("ul-container-hovered"),r.helper.remove()}t(document).trigger("hideDropArea"),i.page.stopDrop(),t(this)&&t(this).hasClass("ui-draggable")&&e.draggable("destroy"),e.show(),"absWidget"==a&&(t("#body").removeAttr("data-drag-type"),t(".ul-abs-animate").removeClass("ul-abs-animate")),p.add({fromFile:"js/edit/constructor.js",title:"stopDragEl",desc:"$target Id: "+u.attr("id")+" widgetType: "+l.type})}}()}).trigger("mousedown.draggable",o)}}(),dragDrop:function(){return function(e,o,n){var r=this;if(e.hasClass("ul-widget"))if(o.hasClass("ul-drop-remove"))r.removeWidget(e);else if(e.data("dropPositionFixed"))r.moveWidget(e,o,0,function(){});else if(o.hasClass("ul-col")&&!o.children(".ul-widget").length)r.moveWidget(e,o,0);else{l.beginAtomic();var a=r.dropIndexWidget(o);o=o.parent();var d=r.dropWrapWidget({$drop:o,index:a.index,moveWidget:n});if(!d)return l.endAtomic(),!1;r.moveWidget(e,d.drop,d.index,function(){l.endAtomic()})}else if(e.hasClass("ul-container"))if(o.hasClass("ul-drop-remove")){if(!i.constructor.deviceMode.isPanelConstructorEditable)return;r.removeBlock(e)}else{var s=o.index(),c=null;t.each(o.parent().children(".ul-container"),function(e,i){t(i).attr("id")===o.attr("id")&&(c=e)}),null==c?c=s:s=c,o.hasClass("ul-drop-container-bottom")&&(s+=1),r.moveEl(e,o,s)}p.add({fromFile:"js/edit/constructor.js",title:"dragDrop",desc:"is elemet widget: "+e.hasClass("ul-widget")})}}(),destroyResizable:function(){return function(e){var o=e.closest(".ul-row").length?e.closest(".ul-row").children(".ul-col"):t(".ul-col",e);o.length&&t.each(o,function(e,o){t(o).hasClass("ui-resizable")&&t(o).resizableBootstrap("destroy")})}}(),dropIndexWidget:function(){return function(e){var o;return e.hasClass("ul-widget")&&t.each(e.closest(".ul-row").children(".ul-col"),function(e,o){t(o).hasClass("ui-resizable")&&t(o).resizableBootstrap("destroy")}),o=e.index(),e.hasClass("ul-drop-right")&&(o+=1),e.hasClass("ul-drop-bottom")&&(o+=1,e.hasClass("ul-widget")&&e.parent(".ul-col").children(".ul-widget").length<o&&e.parent(".ul-col").children(".ul-widget").length==e.index()&&--o),{index:o}}}(),getGrid:function(){return function(){for(var e='<div class ="ul-grid-step col-xs-12 col-sm-12 col-md-12 col-lg-12">',t=0;12>t;t++)e+='<div class="ul-resize-position col-xs-1 col-sm-1 col-md-1"></div>';return e+="</div>"}}(),getId:function(){return function(){return"ul-id-"+this.lastId+"-"+this.lastSessionId++}}(),__moveWidget:function(){return function(e,o,n,a,d){var s=this,l=e.closest(".ul-col");a||(a=function(){return function(){}}());var c=this._moveWidget(e,o,n),u=function(){return function(){s._smartAdjustColSizesOfRow({$row:c.closest(".ul-row"),cb:a})}}(),p=!1;void 0!=o.attr("data-description")&&(o.removeAttr("data-description"),o.closest(".ul-container").children(".ul-block-controls").find(".ul-block-title").text(g("constructor.block")),p=!0);var h={act:"moveWidget",to:o.attr("id"),id:e.attr("id"),index:n};if(e.data("dropPositionFixed")){var f=r.get(e.attr("id"));f?(!f.$el.length&&(f.$el=t("#"+f.id)),h.data=f.data,h.__t=e.data("widget"),h.data.position=f.data.position||i.page.position||"bottom",h.data.party=o.data("position"),s.save(h),f.render(function(){a()})):console.error("__moveWidget",'widget "'+e.attr("id")+'" not found')}else{"mainmenu"===e.data("widget")&&t(window).trigger("mainmenu.needChangeSelector",e),window.dispatch(window.actions.linkWidgetBlock(h.id,o.closest(".ul-container").attr("id"))),window.dispatch(window.actions.linkWidgetCol(h.id,o.closest(".ul-col").attr("id"))),window.dispatch(window.actions.linkColRow(o.closest(".ul-col").attr("id"),c.closest(".ul-row").attr("id"))),this.save(h);var v=function(){return function(){setTimeout(function(){s._smartAdjustColSizesOfRow({$row:e.closest(".ul-row"),cb:a})},500)}}();if(l.children(".ul-widget").length)v();else if(d||void 0!=l.closest(".ul-container").attr("block-empty")&&0!=l.closest(".ul-container").attr("block-empty")&&"false"!=l.closest(".ul-container").attr("block-empty"))if(1<l.closest(".ul-container").find(".ul-col").length){l.closest(".ul-row").attr("id")!==o.closest(".ul-row").attr("id")&&(p?s.widgetStartResize(o.closest(".ul-row").children(".ul-col")):s.widgetStartResize(l));var m=l.closest(".ul-row"),w=m.children(".ul-col").size()-1;0==w?s.removeCol(l,v):s.removeCol(l,function(){p||a()})}else 0==l.children(".ul-widget").length&&(l.attr("data-description",g("constructor.Drag elements from the left panel")),l.closest(".ul-container").find(".ul-drag-container-desc").text(g("constructor.empty block handler name"))),u();else s.widgetStartResize(l),s.removeCol(l,a)}}}(),moveWidget:function(){return function(e,t,o,i){var n={};n.widgetId=e.attr("id"),n.targetId=t.attr("id"),i||(i=function(){return function(){}}()),n.colId=e.closest(".ul-col").attr("id"),t.hasClass("ul-absolute-widgets")||(void 0!=t.attr("data-description")||0!=t.closest(".ul-container").attr("block-empty"))&&2>=e.closest(".ul-container").find(".ul-col").length||(n.flBlockWasEmpty=!0),n.oldIndex=e.closest(".ul-col").children(".ul-widget").get().indexOf(e[0]),n.index=o,p.add({fromFile:"js/edit/constructor.js",title:"moveWidget",desc:"data.widgetId: "+n.widgetId+"data.targetId: "+n.targetId}),l.pushAndExec({act:"moveWidget",data:n},i)}}(),__moveEl:function(){return function(e,o,i,n){var r=this,a=null!=n||void 0!=n?n.attr("id"):null,d={act:"moveEl",index:i,to:o.parent().attr("id"),id:e.attr("id"),prevEl:a},s=this._dropPosition(e,i,o.parent());d.index=s.index(),t("#ul-main").animate({scrollTop:s.offset().top+t("#ul-main").scrollTop()-(t("#ul-main").offset().top+37)},200),r.save(d),e.hasClass("ul-container")&&r.posContainerHandler()}}(),moveEl:function(){return function(e,t,o){var i=e.attr("id"),n=t.attr("id"),r=o<e.index()?e.index()+1:e.index();p.add({fromFile:"js/edit/constructor.js",title:"moveEl",desc:"elId: "+i+"dropId: "+n}),l.pushAndExec({act:"__moveEl",data:{elId:i,dropId:n,index:o,curIndex:r,curDropId:n}})}}(),removeCol:function(){return function(e,o,i,n){var r=this;o||(o=function(){return function(){}}());var a,d=e.attr("id"),s=e.index(),c=e.closest(".ul-row").attr("id");return e.attr("id").match(/special/)?t("#"+d):(a=r._dumpColSizesOfRow(t("#"+c)),p.add({fromFile:"js/edit/constructor.js",title:"removeCol",desc:"id: "+d}),l.pushAndExec({act:"removeCol",data:{id:d,index:s,rowId:c,colSizes:a,notSmartAdj:n}},function(){return r.__removeCol(t("#"+d),o,i,n)}))}}(),__removeCol:function(){return function(e,o,i,n){var r=this,a=e.height();o||(o=function(){return function(){}}()),this.save({act:"removeCol",id:e.attr("id")});var d=e.closest(".ul-row"),s=d.children(".ul-col").size()-1;r._removeCol(e);var l=function(){return function(){r._smartAdjustColSizesOfRow({$row:d,autocrop:!n,cb:o})}}();t.each(d.children(".ul-col"),function(e,o){t(o).hasClass("ui-resizable")&&!t(o).hasClass("ul-widget")&&t(o).resizableBootstrap("destroy")}),0==s?(d.height(a),r.removeRow(d,o,i)):l()}}(),_smartAdjustColSizesOfRow:function(){return function(o){var i=this;o=t.extend({$row:null,autocrop:!0,cb:function(){return function(){}}()},o);var n=i._dumpColSizesOfRow(o.$row),r=[];if(n.length){o.$row.children(".ul-col").each(function(e,o){r.push(i._getMinCols(t(o)))});for(var a=12,d=n.map(function(e,t){var o=r[t];return a-=e,{i:t,s:e-o}}),s=!1;a>0;){s=!0;var l=e.min(d,function(e){return e.s});a--,l.s++,n[l.i]++}for(;0>a;){s=!0;var c=e.max(d,function(e){return e.s});if(0>=c.s)return void console.info("_smartAdjustColSizesOfRow problem!");a++,c.s--,n[c.i]--}for(var u;u=e.find(d,function(e){return 0>e.s});){s=!0;var g=e.max(d,function(e){return e.s});if(0>=g.s)return void console.info("_smartAdjustColSizesOfRow problem!");g.s--,n[g.i]--,u.s++,n[u.i]++}var h=800;s&&(i._restoreColSizesOfRow(o.$row,n),h=700),setTimeout(function(){i.widgetCompleteResize(o.$row,o.cb,o.autocrop)},h),p.add({fromFile:"js/edit/constructor.js",title:"_smartAdjustColSizesOfRow",desc:"timer delay: "+h})}}}(),_dumpColSizesOfRow:function(){return function(e){var o=this,i=[];return o.widgetStartResize(e),e.children(".ul-col").each(function(e,n){var r=t(n);i.push(1*o.REG_CLASS_MD.exec(r.attr("class"))[1])}),i}}(),_restoreColSizesOfRow:function(){return function(e,o){var i=this,n=e.children(".ul-col");i.widgetStartResize(e),n.each(function(e){e+1<n.length&&i.__setColSize(t(n.get(e)),t(n.get(e+1)),o[e],o[e+1])})}}(),__removeRow:function(){return function(e,t,o){var i=this;if(t||(t=function(){return function(){}}()),!e||!e.length)return void a.notify("error $el not exist","error");if(!e.closest(".ul-row"))return void a.notify("error ul-container not exist","error");i.save({act:"removeRow",id:e.attr("id")});var n=e.closest(".ul-container"),r=e.closest(".container"),d=e.closest(".container-fluid");e.animate({height:0},o?0:200,"linear",function(){i._removeRow(e),!r.children(".ul-row").length&&r.length||!d.children(".ul-row").length&&d.length?i.removeBlockWithoutWidgets(!1,n,t):t()})}}(),removeRow:function(){return function(e,o,i){var n=this;o||(o=function(){return function(){}}());var r=e.attr("id"),a=e.index(),d=e.closest(".ul-container").attr("id");p.add({fromFile:"js/edit/constructor.js",title:"removeRow",desc:"id: "+r}),l.pushAndExec({act:"removeRow",data:{id:r,index:a,ulContainerId:d}},function(){return n.__removeRow(t("#"+r),o,i)}),n.activeAutocrop=!1}}(),__removeBlockWithoutWidgets:function(){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},o=this;if(t||(t=function(){return function(){}}()),!e||!e.length)return a.notify("error $el not exist","error");var i=e.closest(".ul-container");if(!i.length)return a.notify("error ul-container not exist","error");var n={act:"removeBlock",id:e.attr("id")},r=e.parent();o._removeBlock(e),o.save(n),r.children(".ul-container").length||r.html('<div class="container ul-drop-placeholder js-block-container"><div class="ul-empty-ingorm"><div class="ul-empty-drag-help"></div> <p>'+g("constructor.Drag elements or block from the left panel")+"</p></div></div>"),o.posContainerHandler(),t()}}(),removeBlockWithoutWidgets:function(){return function(e,o,i){var n=this;i||(i=function(){return function(){}}());var r=o.attr("id"),a=o.index();o.hide();var d=o.attr("id");setTimeout(function(){n.getBlockSettings(d,function(o){o.id=d,n.blockSettings[d]||(n.blockSettings[d]=c.cloneDeep(o));var s=c.cloneDeep(n.blockSettings[r]),u="removeBlockWithoutWidgets";e&&(u="removeBlockEmptyWithoutWidgets"),p.add({fromFile:"js/edit/constructor.js",title:"removeBlockWithoutWidgets",desc:"blockSetting[id]: "+o.id}),l.pushAndExec({act:u,data:{oldBlockSettings:s,index:a,id:r}},function(){e?i():n.__removeBlockWithoutWidgets(t("#"+r),i)})})},200)}}(),__removeBlockWithWidgets:function(){return function(e,o,i){var n=o.find(".ul-widget").map(function(){return t(this).attr("id")}).get();return n.length?(window.dispatch(window.actions.unmountBlock(n,arguments)),void this.posContainerHandler()):this.__realRemoveBlockWithWidgets([],e,o,i)}}(),__realRemoveBlockWithWidgets:function(){return function(e,o,i,n){var r=this,a=[];i.find(".ul-widget").each(function(){a.push(t(this))}),i.css({"min-height":0,"max-height":i.outerHeight(),overflow:"hidden"}),i.css("overflow","hidden"),i.animate({height:0},200,"linear",function(){a.length?u.map(a,function(t,o){var n=t.attr("id");a.indexOf(t)===a.length-1?r.lockBlock(i,!1,function(){r.removeWidget(t,o,!0,!1,!0,e[n])}):r.removeWidget(t,o,!0,!1,!0,e[n])},n):r.lockBlock(i,!1,function(){r.removeBlockWithoutWidgets(o,i,n)})})}}(),removeBlock:function(){return function(e,t){var o=this;t||(t=function(){return function(){}}());var n=!e.find(".ul-widget").length;i.history.beginAtomic(),o.lockBlock(e,!0,function(){o.__removeBlockWithWidgets(n,e,function(){p.add({fromFile:"js/edit/constructor.js",title:"removeBlock"}),i.history.endAtomic(),t()})})}}(),__removeWidget:function(){return function(e,t,o,i,n){var r=e.data("widget")||"";if(r)this.__realRemoveWidget(e,t,o,i,n);else{if(!e.attr("id"))return;window.dispatch(window.actions.unmountWidget(e.attr("id"),arguments))}}}(),__realRemoveWidget:function(){return function(o,n,a,d,s){var l=this,c=o.data("widget")||"",u=o.attr("id");n||(n=function(){return function(){}}());var p=o.closest(".ul-col");o.css({"max-height":o.outerHeight(),overflow:"hidden"});var h=n;n=function(){return function(){"productCard"===c?(i.params.shop.productCardsQuantity--,l.onProductCardRemoved(h)):h()}}();var f=o.closest(".ul-absolute-widgets").length?"removeAbsWidget":"removeWidget";1!==p.children(".ul-widget").length||d||s||!(1<p.parent().children(".ul-col").length)||l.widgetStartResize(p),l.save({act:f,id:u}),1<p.children(".ul-widget").length?(p.css({"min-height":p.height(),"max-height":p.height()}),o.animate({width:0},a?0:200,"linear",function(){t(window).trigger("widgetRemoved",u),l._removeWidget(o),p.css("max-height",""),p.css("min-height",""),0==p.children(".ul-widget").length?d?1<p.closest(".ul-container").find(".ul-col").length?l.removeCol(p,n,a,s):(0==p.children(".ul-widget").length&&"blog"!==i.params.pageType&&(p.attr("data-description",g("constructor.Drag elements from the left panel")),p.closest(".ul-container").find(".ul-drag-container-desc").text(g("constructor.empty block handler name"))),n()):l.removeCol(p,n,a,s):n()})):(p.css({"min-height":p.height(),"max-height":p.height(),"min-width":0,overflow:"hidden"}),p.animate({width:0},a?0:200,"linear",function(){t(window).trigger("widgetRemoved",u),l._removeWidget(o),p.hasClass("ul-absolute-widgets")?(p.css({"min-height":"","max-height":"",width:"",height:"",overflow:""}),n()):d?1<p.closest(".ul-container").find(".ul-col").length?l.removeCol(p,n,a,s):(p.css({"min-height":"","max-height":"",width:"",overflow:"auto"}),0==p.children(".ul-widget").length&&"blog"!==i.params.pageType&&(p.attr("data-description",g("constructor.Drag elements from the left panel")),p.closest(".ul-container").find(".ul-drag-container-desc").text(g("constructor.empty block handler name"))),n()):l.removeCol(p,n,a,s)})),r.remove(u),"removeAbsWidget"==f&&(l.activeAutocrop=!1,t(window).trigger("absWidget",{active:!0,wtype:c})),l.isSingleWidget(c)&&(l.singleWidgets=e.without(l.singleWidgets,c),t(window).trigger("singleWidget",{active:!0,wtype:c}))}}(),isSingleWidget:function(){return function(e){return i.params.singleWidgetsList.some(function(t){return t===e})}}(),isSingleWidgetPage:function(){return function(e){var t=this;return t.isSingleWidget(e)?t.singleWidgets.some(function(t){return e===t}):void 0}}(),removeWidget:function(){return function(e,t,o,n,r,a){t||(t=function(){return function(){}}());var d={id:e.attr("id"),colId:e.closest(".ul-col").attr("id"),widgetType:e.data("widget")||a.type||e.data("type"),index:e.closest(".ul-col").children(".ul-widget").get().indexOf(e[0])},s=i.widget.get(d.id)||a;return d.data=c.cloneDeep(s.data),d.options=c.cloneDeep(s.options),d.flFast=o,d.flNotRemoveCol=n,d.notSmartAdj=r,p.add({fromFile:"js/edit/constructor.js",title:"removeWidget",desc:"id: "+d.id+" widgetType: "+d.widgetType}),l.pushAndExec({act:"removeWidget",server:!0,data:d},t)}}(),save:function(){return function(e,t){p.add({fromFile:"js/edit/constructor.js",title:"save",desc:"save: /sites/url/"+i.params.site+"/pages/id/"+i.params.page+"/save"}),i.enqueueAjax({url:"/sites/url/"+i.params.site+"/pages/id/"+i.params.page+"/save",data:e,parallel:!1,lastId:this.lastId,version:i.params.version,cb:t})}}(),setBlockClasses:function(){return function(e,o){this.save({act:"setBlockClasses",el:e,classes:o}),t("#"+e).attr("class",this.blockClasses.join(" ")+" "+o.join(" "))}}(),__setColSize:function(){return function(e,o,n,r){this._setColSize(e,o,n,r,i.constructor.deviceMode.device);var a={act:"setColSize",el:e.attr("id"),elColSize:n,nextEls:o.map(function(){return t(this).attr("id")}).toArray().join(","),nextElsColSize:r,device:i.constructor.deviceMode.device};this.save(a)}}(),setColSize:function(){return function(e,t,o,i){var n=this,r=e.attr("id"),a=t.attr("id"),d={desktop:{target:parseInt(n.REG_CLASS_MD.exec(e.attr("class"))[1]),next:parseInt(n.REG_CLASS_MD.exec(t.attr("class"))[1])},tablet:{target:parseInt(n.REG_CLASS_SM.exec(e.attr("class"))[1]),next:parseInt(n.REG_CLASS_SM.exec(t.attr("class"))[1])},phone:{target:parseInt(n.REG_CLASS_XS.exec(e.attr("class"))[1]),next:parseInt(n.REG_CLASS_XS.exec(t.attr("class"))[1])}},s=parseInt(n.REG_CLASS_MD.exec(e.attr("class"))[1]),c=parseInt(n.REG_CLASS_MD.exec(t.attr("class"))[1]);return p.add({fromFile:"js/edit/constructor.js",title:"setColSize",desc:"id: "+r+", nextId: "+a}),l.pushAndExec({act:"setColSize",data:{id:r,nextId:a,undoSize:s,undoSizeNext:c,elColSize:o,nextElsColSize:i,prevSize:d}})}}(),_getMinCols:function(){return function(e){var o=0;return e.children(".ul-widget").each(function(e,i){var n=t(i);if(!n.hasClass("ul-el-drag-mask")){var a=r.minColsTable[n.data("widget")||n.attr("type")];a>o&&(o=a)}}),o}}(),setResizeCol:function(){return function(e){var o=this;return"desktop"===i.constructor.deviceMode.device?void window.requestAnimationFrame(function(){var i=[];e.not(":last").each(function(){var e,o=this,n=t(this),r=n.next(".ul-col"),a=n.closest(".ul-row");a.length&&(e=a.outerWidth());var d,s=o.getBoundingClientRect().width+l;r.length&&(d=r[0].getBoundingClientRect().width+l);var l=parseInt(n.css("margin-left"))+parseInt(n.css("margin-right"));i.push({col:this,$col:n,$next:r,$row:a,widthParentElement:e,widthThisElement:s,widthNextEl:d,marginEl:l})}),i.forEach(function(e){return o.addResizableToCol(e.col,e.$col,e.$next,e.$row,e.widthParentElement,e.widthThisElement,e.widthNextEl,e.marginEl)})}):void(e.hasClass("ui-resizable")&&this.destroyResizable(e))}}(),addResizableToCol:function(){return function(e,o,i,n,r,a,d,s){var l,c=this,u=null;setTimeout(function(){o.resizableBootstrap({handles:"e",create:function(){return function(){u=t('<div class="ul-resizable-view"></div>'),u.css("background-color","rgba(203,210,217,1)"),u.appendTo(o.children(".ui-resizable-e"))}}(),start:function(){return function(e,r){c.widgetStartResize(o,!0),c.activeResize=!0,t(".js-back-click").attr("data-type-block")&&t(".ul-disabled-overlay").trigger("click.constructor"),c.$body.attr("data-controls","resize"),r.element.find(".ul-resizable-view").addClass("ul-resizeble-view-hover"),o.css({overflow:"hidden"}),i.css({overflow:"hidden"}),n.find(".ul-grid-step").remove(),n.prepend(c.getGrid()),void 0==i&&o.resizableBootstrap("widget").trigger("mouseup"),a=this.getBoundingClientRect().width,d=i[0].getBoundingClientRect().width,l=a+d,p.add({fromFile:"js/edit/constructor.js",title:"start resize col",desc:"row id: "+n.attr("id")})}}(),resize:function(){return function(){var e=this.getBoundingClientRect().width,n=100*((i[0].getBoundingClientRect().width+s)/r),a=l-e;i.outerWidth(a-s);var d=_Mathround(100*(e/r));i.find(".owl-item.active").length&&t.each(i.find(".owl-item.active"),function(e,o){t(o).width(a)}),o.find(".owl-item.active").length&&t.each(o.find(".owl-item.active"),function(e,i){
t(i).width(o.width())}),[[o,d],[i,n]].forEach(function(e){var t=e[0],i=e[1],n=c.STEP_GRID*c._getMinCols(t)-1;n>i&&o.resizableBootstrap("widget").trigger("mouseup")})}}(),stop:function(){return function(l,u){o.css({overflow:""}),i.css({overflow:""}),c.$body.removeAttr("data-controls"),t(".ul-resizeble-view-hover").removeClass("ul-resizeble-view-hover"),a=this.getBoundingClientRect().width+s,d=i[0].getBoundingClientRect().width+s,u.element.find(".ul-resizable-view-hover").removeClass("ul-resizeble-view-hover"),c.activeResize=!1,n.find(".ul-grid-step").remove(),t(document).off("hoverHandler");var g=_Mathround(100*((e.getBoundingClientRect().width+s)/r)),h=_Mathround(100*((a+d)/r)),f=_Mathround(g/c.STEP_GRID),v=_Mathround((h-g)/c.STEP_GRID);0==f?(f+=2,v-=2):0==v&&(f-=2,v+=2),p.add({fromFile:"js/edit/constructor.js",title:"stop resize col"}),c.setColSize(o,i,f,v)}}()})},0)}}(),changeColSize:function(){return function(){var o=this,i=t(),n=null;return o.startColChange&&o.stopColChange&&t.each(o.startColChange,function(r,a){if(a.rowId===o.stopColChange.rowId){n=r;var d=o.eq,s=[];a.eq&&(d=a.eq+1),a.colLength<=o.stopColChange.colLength&&(a.col.size.splice(d,0,0),a.col.index.push(a.col.index.length)),a.colLength>=o.stopColChange.colLength&&(a.col.size.splice(d,1),a.col.index.pop(a.col.index.length)),t.each(a.col.size,function(e,t){t!=o.stopColChange.col.size[e]&&(s.push(e),i=i.add(a.$row.children(".ul-col").eq(e)))}),i.length||t.each(a.col.index,function(e,t){s.push(t),i=i.add(a.$row.children(".ul-col").eq(t))});var l=e.sortBy(e.uniq(s),function(e){return Math.min(e)});(2>l.legth||2<l.reduce(function(e,t,o,i){var n=_Mathabs((i[o-1]||0)-t);return Math.max(n,e)},_Mathabs(l[0]-l[1])))&&l.forEach(function(e){[e-1,e+1].forEach(function(e){i=i.add(a.$row.children(".ul-col").eq(e))})})}else a.$row.children(".ul-col").length&&(i=i.add(a.$row.children(".ul-col")))}),null!==n&&1<o.startColChange.length?o.startColChange.splice(n,1):null!==n&&delete o.startColChange,delete o.stopColChange,i}}(),getStartChangeCol:function(){return function(e){var o=this;if(o.startColChange&&o.startColChange.length||(o.startColChange=[]),o.startColChange.length){var i=!0;t.each(o.startColChange,function(t,o){o.rowId!==e.closest(".ul-row")&&(i=!1)}),i||(o.startColChange.push({rowId:e.closest(".ul-row").attr("id"),$row:e.closest(".ul-row"),colLength:e.closest(".ul-row").children(".ul-col").length,col:{index:[],size:[]}}),e.closest(".ul-row").children(".ul-col").each(function(e,i){var n=t(i);o.startColChange[o.startColChange.length-1].col.index.push(n.index());var r=2;o.REG_CLASS_MD.exec(n.attr("class"))?r=o.REG_CLASS_MD.exec(parseInt(n.attr("class"))[1]):o.REG_CLASS_XS.exec(n.attr("class"))?r=o.REG_CLASS_XS.exec(parseInt(n.attr("class"))[1]):o.REG_CLASS_SM.exec(n.attr("class"))&&(r=o.REG_CLASS_SM.exec(parseInt(n.attr("class"))[1])),o.startColChange[o.startColChange.length-1].col.size.push(r)}))}else o.startColChange.push({rowId:e.closest(".ul-row").attr("id"),$row:e.closest(".ul-row"),colLength:e.closest(".ul-row").children(".ul-col").length,col:{index:[],size:[]}}),e.closest(".ul-row").children(".ul-col").each(function(e,i){var n=t(i);o.startColChange[0].col.index.push(n.index()),o.REG_CLASS_MD.exec(n.attr("class"))?o.startColChange[0].col.size.push(parseInt(o.REG_CLASS_MD.exec(n.attr("class"))[1])):o.REG_CLASS_XS.exec(n.attr("class"))?o.startColChange[0].col.size.push(parseInt(o.REG_CLASS_XS.exec(n.attr("class"))[1])):o.REG_CLASS_SM.exec(n.attr("class"))&&o.startColChange[0].col.size.push(parseInt(o.REG_CLASS_SM.exec(n.attr("class"))[1]))})}}(),getStopChangeCol:function(){return function(e){var o=this;o.stopColChange={rowId:e.attr("id"),$row:e,colLength:e.children(".ul-col").length,col:{index:[],size:[]}},e.children(".ul-col").each(function(e,i){var n=t(i);o.stopColChange.col.index.push(n.index()),o.stopColChange.col.size.push(1*o.REG_CLASS_MD.exec(n.attr("class"))[1])})}}(),widgetStartResize:function(){return function(e,o){var i=this,n=t();o?(n=n.add(e).add(e.next()),i.getStartChangeCol(e)):e.hasClass("container")||e.hasClass("container-fluid")?n=e.find(".ul-col"):(i.getStartChangeCol(e),t.each(i.startColChange,function(o,i){i.rowId===e.closest(".ul-row").attr("id")&&t.each(i.col.index,function(e,t){n=n.add(i.$row.children(".ul-col").eq(t))})})),i.activeAutocrop=!0}}(),complete_getNoChangedCol:function(){return function(e,o){if(!e||!o)return null;var i=e.closest(".ul-row"),n=o.closest(".ul-row");return i.attr("id")!==n.attr("id")||e.length===o.length?null:(t.each(e,function(e,i){t.each(o,function(e,n){t(i).attr("id")===t(n).attr("id")&&o.splice(e,1)})}),o)}}(),widgetCompleteResize:function(){return function(e,o,i){var n=this,r=t(),a=null;o||(o=function(){return function(){}}()),p.add({fromFile:"js/edit/constructor.js",title:"widgetCompleteResize"}),e.hasClass("container")||e.hasClass("container-fluid")?r=e.find(".ul-col"):(n.getStopChangeCol(e),n.startColChange&&(a=n.startColChange.$sendCol,r=n.changeColSize())),r.length?(delete n.startColChange,a&&(a=n.complete_getNoChangedCol(r,a)),p.add({fromFile:"js/edit/constructor.js",title:"widgetCompleteResize find changed cols",desc:r.length+" cols was changed"}),x.stop(r,i),t(window).trigger("changeColEnd",r),t(window).trigger("colResized",r),o(),r=null,a=null):o(),n.activeAutocrop=!1}}(),formatWidgetDataToReact:function(){return function(e){return{controls:"mer",id:e.id,forceSave:e.forceSave||!1,type:e.widgetType,data:e.data||{},opts:e.opts||e.options||{},hidden:!1}}}(),draggableDestroy:function(){return function(){var e=t(".ui-draggable");e.length&&e.draggable("destroy")}}(),destroy:function(){return function(){var e=this;e._destroyEvents(),b.destroy()}}()};return t.extend(I,f,v,m,w,_),Object.keys(I).forEach(function(e){if(e.match(/HistoryAction$/)){var t=I[e];l.regAction(I,t),delete I[e]}}),I});
//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map
