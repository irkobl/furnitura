"use strict";define("editor",["U","_","text!/widgets/wysiwyg/editorControls.html","imagelib","imagecrop","panelDialog","link","popup","i18n","classapplier","css!/css/require/widgets/editor.css","videoBox","jquery","jquery-ui-resizable-bootstrap"],function(e,t,n,i,o,r,l,s,a,c,u,d){var f={opt:null,vars:{},init:function(){return function(e){var i=this;if(e.$el.closest(".ul-widget").length&&e.$el.closest(".ul-widget").hasClass("js-w-remove"))return!1;if(i.vars.enabled){if(i.opt.$el.get(0)==e.$el.get(0))return;i.deinit()}i.opt=$.extend({__:a,$el:null,parent:"#ul-main",placeholder:"",defaultTag:"p",inlineButtons:["bold","italic","link"],imageButtons:["edit","separator","align","separator","link","separator","remove"],videoButtons:["align","separator","remove"],additionalButtons:{title:"title",tags:{h2:"header2",h3:"header3",h4:"header4",p:"paragraph",h5:"important",h6:"node"},settings:[["bold","italic"],["align"],["lists"],["link","image"]]},image:!0,autosave:1e4,imageMinWidth:16,imageMinHeight:16,imageMargin:10,additionalPanel:!0,inlinePanel:!0,inlinePanelFixed:!1,inlineAlwaysShow:!0,useEnter:!0,clearFormat:!0,useText:!1,imgCrop:!0,alignFull:!1,theme:"g-theme-site-1",blockTheme:"g-theme-block-1",colors:["g-color-text-1","g-color-text-2","g-color-text-3"],save:function(){return function(){}}(),select:function(){return function(){}}(),beforeAction:function(){return function(){}}(),beforeClose:function(){return function(){}}(),beforeOpen:function(){return function(){}}(),afterOpen:function(){return function(){}}(),changeHtml:function(){return function(){}}(),removeImg:function(){return function(){}}()},e),i.opt.beforeOpen(i.vars),i.vars.$parent=$(""+i.opt.parent),i.vars.oldHtml=i.opt.$el.html(),i.opt.$el.attr("contenteditable",!0).attr("spellcheck",!1).addClass("ul-editableWithEditor"),i.vars.enabled=!0,document.execCommand("defaultParagraphSeparator",!1,"p"),document.execCommand("enableObjectResizing",!1,!1),document.execCommand("styleWithCSS",!1,!0),i.opt.placeholder.length||(i.opt.placeholder=i.opt.$el.attr("placeholder")),i.vars.$renderedControls=$(t.template(n,i.opt)),i._controls("add"),i._addEventListener(),i.opt.afterOpen(i.vars),i._isEmpty(),i.opt.colors&&i.opt.colors.length&&(i.vars.colorClasses={},i.opt.colors.forEach(function(e){i.vars.colorClasses[e]=c.createClassApplier(e)})),i._readMore.check()}}(),deinit:function(){return function(){var e=this;e.opt&&e.opt.$el.length&&(e.opt.beforeClose(e.vars),e.save(),e._controls("remove"),$(window).off(".wysiwygEvents"),e.opt.$el.off(".wysiwygEvents").removeAttr("contenteditable").removeClass("ul-editableWithEditor").blur(),clearInterval(e.vars.timer),e.insertPlaceholder({$el:e.opt.$el,placeholder:e.opt.placeholder,tag:e.opt.defaultTag}),e._selection.clear(),e.vars={},e.vars.enabled=!1,e.opt=null)}}(),save:function(){return function(){var e=this;if(e.opt.$el.length){e.opt.$el.find(".js-editor-empty-placeholder").length&&(e.opt.$el.find(".js-editor-empty-placeholder").remove(),e.opt.$el.html("<"+e.opt.defaultTag+">&nbsp;</"+e.opt.defaultTag+">"));var t=e.opt.$el.html();if(12e4<t.length)return void console.warn("Слишком много текста");t!=e.vars.oldHtml&&(e.opt.useText&&(t=e.opt.$el.text()),e.opt.save(t),e.vars.oldHtml=t)}}}(),isOpen:function(){return function(){return this.vars.enabled||!1}}(),_addEventListener:function(){return function(){var e=this;$(window).on("resize.wysiwygEvents",function(){e.opt.inlinePanel&&e._inlineControls.checkShow(),e.opt.image&&null!=e._imageControls.$img&&e._imageControls.position()}),e.opt.$el.on("mouseup.wysiwygEvents",function(t){var n=$(t.target);if(e._lightenControls(),!e._imageControls.resize&&!e._videoControls.resize)if("IMG"===n.get(0).tagName){if(!e.opt.image)return;null==e._imageControls.$img?e._imageControls.show(n):e._imageControls.$img.get(0)!=n.get(0)&&(e._imageControls.hide(),setTimeout(function(){e._imageControls.show(n)},100)),null!=e._videoControls.$video&&e._videoControls.hide(),e.opt.inlinePanel&&e._inlineControls.hide(),e._readMore.deactivate()}else n.hasClass("video-inline")?(null==e._videoControls.$video?e._videoControls.show(n):e._videoControls.$video.get(0)!=n.get(0)&&(e._videoControls.hide(),setTimeout(function(){e._videoControls.show(n)},100)),null!=e._imageControls.$img&&e._imageControls.hide(),e.opt.inlinePanel&&e._inlineControls.hide(),e._readMore.deactivate()):"HR"===n.get(0).tagName?(e._readMore.activate(n),e._selection.clear()):(e._selection.save(),e.opt.inlinePanel&&e._inlineControls.checkShow(),e.opt.image&&e._imageControls.hide(),e._videoControls.hide(),e._readMore.deactivate())}).on("mousedown.wysiwygEvents",function(){e._selection.clear(),e.opt.inlinePanel&&!e.opt.inlinePanelFixed&&e._inlineControls.hide()}).on("keyup.wysiwygEvents",function(t){e._isEmpty(),e._selection.save(),null==e._imageControls.$img&&e.opt.inlinePanel&&e._inlineControls.checkShow(),f._lightenControls(),13==t.keyCode&&f.opt.$el.find(".video-inline").each(function(e,t){$(t).find("iframe").length||$(t).removeClass("video-inline").removeAttr("data-signature").removeAttr("style")}),8==t.keyCode&&f.opt.$el.find(".video-inline").each(function(e,t){var n=!1;$(t).children().each(function(e,i){"IFRAME"!=$(i).prop("tagName")&&($(t).before($(i).wrap("<p />")),n=!0)}),n&&$(t).remove()}),f.opt.$el.find(".video-inline").each(function(e,t){var n=$(t).contents();1<n.length&&n.each(function(e,n){if("IFRAME"!=n.nodeName){$(n).insertAfter(t).wrap("<p />");var i=document.createRange(),o=window.getSelection();i.setStart($(n)[0],$(n).length),i.collapse(!0),o.removeAllRanges(),o.addRange(i)}})})}).on("keydown.wysiwygEvents",function(t){return e._isEmpty(),e._readMore.deactivate(),e._readMore.check(),46==t.keyCode&&e.vars.empty&&t.preventDefault(),(e.opt.useEnter||13!=t.keyCode)&&void e._changeInner()}).on("dragstart.wysiwygEvents",e.opt.$el,function(){return e._selection.clear(),!1}).on("drop.wysiwygEvents",function(){return!1}).on("paste.wysiwygEvents",function(n){n.preventDefault();var i="";return null!=n.originalEvent.clipboardData&&(i=n.originalEvent.clipboardData.getData("text/plain")),0<i.length&&(i=t.escape(i),e._applySelection.text("inserthtml",i)),!1}),e.opt.autosave&&(e.vars.timer=setInterval(function(){e.save()},e.opt.autosave))}}(),_lightenControls:function(){return function(){var e=this._lightControls.getList();this.vars.empty||this._controls("light",e),this._readMore.check()}}(),_isEmpty:function(){return function(){var e=this,t=this.opt.$el,n=t.find(".js-editor-empty-placeholder").length;n&&t.find(".js-editor-empty-placeholder").remove(),e.vars.empty=!1,0==t.text().replace(/\s/g,"").length&&0==t.find("img").length&&0==t.find("iframe").length&&(e.vars.empty=!0,n?(t.html("<"+e.opt.defaultTag+">&nbsp;</"+e.opt.defaultTag+">"),setTimeout(function(){var e=document.createRange();e.setStart(t.get(0),0),e.setEnd(t.get(0),0),t.get(0).focus()},10)):!0===e.opt.passFFbag||(t.html("&nbsp;"),e._applySelection.text("formatBlock",e.opt.defaultTag.toUpperCase()),e._selection.save(),e._applySelection.text("selectAll"),e._applySelection.text("removeFormat"),e._selection.restore()))}}(),_changeInner:function(){return function(){this.opt.changeHtml()}}(),insertPlaceholder:function(){return function(e){var t=e.$el;t.find(".js-editor-empty-placeholder").remove(),0==t.text().replace(/\s/g,"").length&&0==t.find("img").length&&0==t.find("iframe").length&&t.html("<"+e.tag+' class="js-editor-empty-placeholder">'+e.placeholder+"</"+e.tag+">")}}(),_controls:function(){return function(e,t){var n=this;null!=e&&(n.opt.inlinePanel&&n._inlineControls[e](t),n.opt.additionalPanel&&n._additionalControls[e](t),n.opt.image&&"light"!=e&&n._imageControls[e](t),"light"!=e&&n._videoControls[e](t))}}(),_readMore:{activate:function(){return function(e){this.$el=e,this.$el.addClass("active"),f.opt.$el.on("keydown.wysiwygReadMore",function(t){(8==t.keyCode||46==t.keyCode)&&e.remove()})}}(),deactivate:function(){return function(){null!=this.$el&&(this.$el.removeClass("active"),f.opt.$el.off("keydown.wysiwygReadMore"),this.$el=null)}}(),check:function(){return function(){var e=f.opt.$el.find("hr").length,t=$('[data-val="<hr>"]');e?t.attr("disabled","disabled"):t.removeAttr("disabled")}}()},_additionalControls:{add:function(){return function(){var t=this;f.opt.theme=e.params.siteTheme,r.show({required:["additionalEditor"],templateUrl:"/widgets/wysiwyg/additionalEditor.html",templateData:f.opt,templateCss:["/css/require/widgets/editorAdditional.css"],afterOpen:function(){return function(){t.light(f._lightControls.getList())}}()}),$(document).on("panelClick",function(e,t){if(null==t.dialog){if(f._imageControls.$img&&f._imageControls.$img.length)return;f._applySelection.text(t.cmd,t.val)}else f._dialog[t.dialog]()})}}(),light:function(){return function(e){$(document).trigger("lightControls",e)}}(),remove:function(){return function(){$(document).off("panelClick"),r.hide()}}()},_videoControls:{resize:!1,events:!1,setResizing:!1,add:function(){return function(){f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-video-controls")),this.$el=$("#ul-editor-video-controls")}}(),show:function(){return function(e){this.$video&&(this.hide(),this._imageControls.hide()),this.$video=e,this.light(),f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-video-resize").clone()),this.$resize=$("#ul-editor-video-resize"),this.$el.addClass("editor-visible"),this.position(),this.events||this.addEvents(),this.setResizing||(this.setResize(),this.setResizing=!0)}}(),position:function(){return function(){var e=this,t=-5,n=10,i=0,o=e.$video.offset().top-e.$el.height()-n+f.vars.$parent.scrollTop(),r=e.$video.offset().left+e.$video.outerWidth()/2-e.$el.outerWidth()/2,l="bottom";r<f.opt.$el.offset().left&&(i=f.opt.$el.offset().left-r),r+e.$el.outerWidth()>f.opt.$el.offset().left+f.opt.$el.outerWidth()&&(i=f.opt.$el.offset().left+f.opt.$el.outerWidth()-(r+e.$el.outerWidth())),r+=i,e.$video.offset().top<e.$el.height()+n&&(o+=e.$el.height()+e.$video.outerHeight()+2*n,l="top"),t+=-1*i,e.$resize.css({height:e.$video.outerHeight(),width:e.$video.width(),top:e.$video.offset().top+f.vars.$parent.scrollTop(),left:e.$video.offset().left}),e.$el.css({top:o,left:r}),$(".editor-inline-arrow",e.$el).css("margin-left",t).attr("data-gravity",l)}}(),addEvents:function(){return function(){var e=this;this.$el.find("button").on("click.wysiwygEvents",function(){e.applyVideo($(this).data("cmd")||$(this).data("dialog"))}),f.opt.$el.on("keydown.videoEvent",function(t){var n=e.$video;return(8==t.keyCode||46==t.keyCode)&&(e.hide(),n.remove(),f._selection.restore()),!1}),e.events=!0}}(),applyVideo:function(){return function(e){var t=this,n={justifyleft:function(){return function(){t.$video.css("float","left").css("clear","none"),t.offsets("left")}}(),justifycenter:function(){return function(){t.$video.css("float","none").css("clear","both"),t.offsets("none")}}(),justifyright:function(){return function(){t.$video.css("float","right").css("clear","none"),t.offsets("right")}}(),remove:function(){return function(){var e=t.$video;t.hide(),e.remove(),f._selection.restore()}}()};n[e]&&n[e](),"remove"!=e&&this.light()}}(),light:function(){return function(){if(this.$video.length){$("button",this.$el).removeClass("active");var e=this.$video.css("float");"none"==e&&(e="center"),$('button[data-cmd="justify'+e+'"]',this.$el).addClass("active")}}}(),setResize:function(){return function(){var e=this;this.$resize.resizableBootstrap({handles:{nw:".editor-video-resize-tl",ne:".editor-video-resize-tr",sw:".editor-video-resize-bl",se:".editor-video-resize-br"},minWidth:f.opt.imageMinWidth,minHeight:f.opt.imageMinHeight,maxWidth:f.opt.$el.width(),aspectRatio:e.$video.width()/e.$video.outerHeight(),start:function(){return function(){e.resize=!0,e.$video.css({width:"100%"})}}(),stop:function(){return function(t,n){e.resize=!1,e.$video.css({width:n.size.width}),e.position()}}(),resize:function(){return function(){e.position()}}(),alsoResize:e.$video}),this.setResizing=!0}}(),hide:function(){return function(){var e=this;this.resize||(this.$el.removeClass("editor-visible"),this.$video=null,setTimeout(function(){e.$el.css({top:"auto",left:"auto"})},100),this.removeEvents())}}(),offsets:function(){return function(e,t){var n=!1;null==t&&(t=this.$video,n=!0);var i={none:function(){return function(){return f.opt.imageMargin/2+"px auto"}}(),left:function(){return function(){return f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px "+f.opt.imageMargin/2+"px 0"}}(),right:function(){return function(){return f.opt.imageMargin/2+"px 0 "+f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px"}}()};t.css("margin",i[e]()),n&&this.position()}}(),removeEvents:function(){return function(){this.events&&(this.$el.find("button").off(".wysiwygEvents"),f.opt.$el.off("keydown.videoEvent"),this.events=!1),this.setResizing&&(this.$resize.resizableBootstrap("destroy"),this.$resize.remove(),this.setResizing=!1)}}(),remove:function(){return function(){this.removeEvents(),this.$el.remove(),this.$video=null}}()},_imageControls:{resize:!1,events:!1,setResizing:!1,add:function(){return function(){f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-image-controls")),this.$el=$("#ul-editor-image-controls")}}(),addEvents:function(){return function(){var e=this;this.$el.find("button").on("click.wysiwygEvents",function(){e.applyImage($(this).data("cmd")||$(this).data("dialog"))}),f.opt.$el.on("keydown.imgEvent",function(t){var n=e.$img;return(8==t.keyCode||46==t.keyCode)&&(e.hide(),n.remove(),f.opt.removeImg(),f._selection.restore(),!1)}),e.events=!0}}(),show:function(){return function(e){this.$img&&this._videoControls.hide(),this.$img=e,this.light(),f._selection.clear(),null!=e&&(f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-image-resize").clone()),this.$resize=$("#ul-editor-image-resize"),this.$el.addClass("editor-visible"),this.position(),!this.events&&this.addEvents(),!this.setResizing&&(this.setResize(),this.setResizing=!0))}}(),position:function(){return function(){var e=this,t=-5,n=10,i=0,o=e.$img.offset().top-e.$el.height()-n+f.vars.$parent.scrollTop(),r=e.$img.offset().left+e.$img.outerWidth()/2-e.$el.outerWidth()/2,l="bottom";r<f.opt.$el.offset().left&&(i=f.opt.$el.offset().left-r),r+e.$el.outerWidth()>f.opt.$el.offset().left+f.opt.$el.outerWidth()&&(i=f.opt.$el.offset().left+f.opt.$el.outerWidth()-(r+e.$el.outerWidth())),r+=i,e.$img.offset().top<e.$el.height()+n&&(o+=e.$el.height()+e.$img.height()+2*n,l="top"),t+=-1*i,e.$resize.css({height:e.$img.height(),width:e.$img.width(),top:e.$img.offset().top+f.vars.$parent.scrollTop(),left:e.$img.offset().left}),e.$el.css({top:o,left:r}),$(".editor-inline-arrow",e.$el).css("margin-left",t).attr("data-gravity",l)}}(),hide:function(){return function(){var e=this;this.resize||(this.$el.removeClass("editor-visible"),this.$img=null,setTimeout(function(){e.$el.css({top:"auto",left:"auto"})},100),this.removeEvents())}}(),setResize:function(){return function(){var e=this;this.$resize.resizableBootstrap({handles:{nw:".editor-img-resize-tl",ne:".editor-img-resize-tr",sw:".editor-img-resize-bl",se:".editor-img-resize-br"},minWidth:f.opt.imageMinWidth,minHeight:f.opt.imageMinHeight,maxWidth:f.opt.$el.width(),aspectRatio:e.$img.width()/e.$img.height(),start:function(){return function(){e.resize=!0,e.$img.css({"max-height":"100%","max-width":"100%"})}}(),stop:function(){return function(t,n){e.resize=!1,e.$img.css({height:"100%",width:"100%","max-height":n.size.height,"max-width":n.size.width}),e.position()}}(),resize:function(){return function(){e.position()}}(),alsoResize:e.$img}),this.setResizing=!0}}(),applyImage:function(){return function(e){var t=this,n={edit:function(){return function(){f._dialog.image()}}(),justifyleft:function(){return function(){t.$img.attr("align","left"),t.offsets("left")}}(),justifycenter:function(){return function(){t.$img.attr("align","none"),t.offsets("none")}}(),justifyright:function(){return function(){t.$img.attr("align","right"),t.offsets("right")}}(),link:function(){return function(){f._dialog.link()}}(),crop:function(){return function(){f._dialog.crop()}}(),remove:function(){return function(){var e=t.$img;t.hide(),e.remove(),f._selection.restore(),f.opt.removeImg()}}()};n[e]&&n[e](),"remove"!=e&&this.light()}}(),light:function(){return function(){if(this.$img.length){var e=this.$img.attr("align");$("button",this.$el).removeClass("active"),"A"==this.$img.parent().get(0).tagName&&$('button[data-dialog="link"]',this.$el).addClass("active"),"none"==e&&(e="center"),$('button[data-cmd="justify'+e+'"]',this.$el).addClass("active")}}}(),offsets:function(){return function(e,t){var n=!1;null==t&&(t=this.$img,n=!0);var i={none:function(){return function(){return f.opt.imageMargin/2+"px auto"}}(),left:function(){return function(){return f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px "+f.opt.imageMargin/2+"px 0"}}(),right:function(){return function(){return f.opt.imageMargin/2+"px 0 "+f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px"}}()};t.attr("align",e).css("margin",i[e]()),n&&this.position()}}(),removeEvents:function(){return function(){this.events&&(this.$el.find("button").off(".wysiwygEvents"),f.opt.removeImg&&f.opt.$el.off("keydown.imgEvent"),this.events=!1),this.setResizing&&(this.$resize.resizableBootstrap("destroy"),this.$resize.remove(),this.setResizing=!1)}}(),remove:function(){return function(){this.removeEvents(),this.$el.remove(),this.$img=null}}()},_inlineControls:{add:function(){return function(){f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-inline-controls")),this.$el=$("#ul-editor-inline-controls"),this.addEvents()}}(),addEvents:function(){return function(){var e=this;e.$el.on("click.wysiwygEvents",function(t){if(t.target&&"BUTTON"==t.target.tagName){var n=$(t.target),i=n.data("cmd"),o=n.data("dialog"),r=n.data("val");null!=i&&f._applySelection.text(i,r),null!=o&&f._dialog[o]()}else e.hide()})}}(),checkShow:function(){return function(){var e,t=f._selection.getSelected();f.opt.inlinePanelFixed?(this.show(),this.position()):null!=t&&(f.opt.select(t),e=t.getBoundingClientRect(),1<e.width&&!f.vars.empty?(this.show(),this.position(e)):this.hide())}}(),show:function(){return function(){this.$el.addClass("editor-visible")}}(),hide:function(){return function(){var e=this;this.$el.removeClass("editor-visible"),e.$el.css({top:"auto",left:"auto"})}}(),calcPosition:function(){return function(e){var t=this,n=10,i=t.$el.height()+n,o=e.top+f.vars.$parent.scrollTop()-5-i,r=e.left-t.$el.outerWidth()/2+e.width/2,l=0,s="bottom";return o-=$("#ul-main").offset().top,r<f.opt.$el.offset().left&&(l=f.opt.$el.offset().left-r),r+t.$el.outerWidth(!0)>f.opt.$el.offset().left+f.opt.$el.outerWidth(!0)&&(l=f.opt.$el.offset().left+f.opt.$el.outerWidth()-(r+t.$el.outerWidth())),r+=l,0>o-n&&(o+=i+e.height+n,s="top"),{top:o,left:r,offset:-1*l,bottomPos:s}}}(),position:function(){return function(e){var t,n=this,i=-5;if(f.opt.inlinePanelFixed){var o=f.opt.$el.offset().top-n.$el.height()-20+f.vars.$parent.scrollTop(),r="bottom";0>o&&(o+=f.opt.$el.height()+n.$el.height()+40,r="top"),t={top:o,left:f.opt.$el.offset().left,offset:-1*(n.$el.width()/2-20),bottomPos:r}}else t=n.calcPosition(e);i+=t.offset,n.$el.width()<f.opt.$el.outerWidth(!0)||f.opt.inlineAlwaysShow?(this.$el.css({top:t.top,left:t.left}),$(".editor-inline-arrow",n.$el).css("margin-left",i).attr("data-gravity",t.bottomPos)):(this.hide(),console.warn("Слишком мало места что бы отобразить инлайновую панель."))}}(),light:function(){return function(e){var t=this;$("button",t.$el).removeClass("active"),Object.keys(e).forEach(function(e){var n="cmd";null==e||("link"==e&&(n="dialog"),$("button[data-"+n+'="'+e+'"]',t.$el).addClass("active"))})}}(),remove:function(){return function(){this.$el.remove()}}()},_applySelection:{html:function(){return function(e,t){var n,i;if(window.getSelection){if(n=window.getSelection(),n.getRangeAt&&n.rangeCount){i=n.getRangeAt(0),i.deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var r,l,s=document.createDocumentFragment();r=o.firstChild;)l=s.appendChild(r);var a=s.firstChild;i.insertNode(s),l&&(i=i.cloneRange(),i.setStartAfter(l),t?i.setStartBefore(a):i.collapse(!0),n.removeAllRanges(),n.addRange(i))}}else if((n=document.selection)&&"Control"!=n.type){var c=n.createRange();c.collapse(!0),n.createRange().pasteHTML(e),t&&(i=n.createRange(),i.setEndPoint("StartToStart",c),i.select())}}}(),text:function(){return function(e,t){t=t||null,f.opt.beforeAction(e,t,f._selection.getSelected()),f.opt.$el.focus(),s.opened&&f._selection.restore(),f.opt.clearFormat&&"formatblock"==e&&document.execCommand("removeformat",!1,null),"forecolor"==e?this.color(t):document.execCommand(e,!1,t),f._lightenControls(),f.opt.inlinePanel&&f._inlineControls.checkShow(),f._changeInner(),s.opened&&f._selection.save()}}(),video:function(){return function(e){f._selection.restore(),this.html('<p class="video--new" />',!1);var t=$("#js-blog-post-content").find(".video--new");if("js-blog-post-content"!=t.parent().attr("id")){for(var n=t.parent();"js-blog-post-content"!=n.parent().attr("id")&&0!=n.length;)n=n.parent();var i=n.contents().filter(function(){return"BR"!=this.nodeName});1==i.length&&i.eq(0).is(t)?t=n:t.insertAfter(n)}t.removeClass("video--new").addClass("video-inline").attr("data-signature",e.signature).attr("data-html",encodeURIComponent(e.html)).html(e.html)}}(),color:function(){return function(e){Object.keys(f.vars.colorClasses).forEach(function(e){f.vars.colorClasses[e].undoToSelection()}),f.vars.colorClasses[e].applyToSelection(),f._changeInner()}}(),image:function(){return function(e){var t=f._imageControls.$img;null==t?(this.text("insertImage",e.src),t=$('img[src="'+e.src+'"]:not(.img-responsive)',f.opt.$el),t.addClass("img-responsive"),f._imageControls.offsets("none",t)):(f._imageControls.hide(),t.attr("src",e.src)),t.wrap('<span class="ul-editor-loading-img" style="'+t.attr("style")+'"></span>'),$(".ul-editor-loading-img").css("float",t.attr("align")),t.on("load.imgLoading",function(){setTimeout(function(){f.vars.enabled&&!f._inlineControls.$el.hasClass("editor-visible")&&(f._imageControls.show(t),f._imageControls.light())},100),t.unwrap('<span class="ul-editor-loading-img"></span>').off("load.imgLoading"),f._changeInner()})}}(),link:function(){return function(e,t){var n;if(f._selection.restore(),null==f._imageControls.$img)n=f._selection.getFocusNode(),null==e?("A"==n.get(0).tagName&&n.contents().unwrap("<a>"),this.text("unlink",null)):("A"==n.get(0).tagName?n.attr("href",e):(this.text("unlink",null),this.text("createLink",e),n=f._selection.getFocusNode()),t?n.attr("target","_blank"):n.removeAttr("target"),f._selection.clear(),f._inlineControls.hide());else{var i=null==f._imageControls.$img.attr("alt")?"":f._imageControls.$img.attr("alt");null==e?"A"==f._imageControls.$img.parent().get(0).tagName&&f._imageControls.$img.unwrap("<a>"):("A"!=f._imageControls.$img.parent().get(0).tagName&&f._imageControls.$img.wrap("<a>"),f._imageControls.$img.parent().attr("href",e).attr("alt",i),t?f._imageControls.$img.parent().attr("target","_blank"):f._imageControls.$img.parent().removeAttr("target")),f._imageControls.light()}f._changeInner()}}()},_lightControls:{getList:function(){return function(){var e=this,t=f._selection.getFocusNode(),n={};return null!=t&&t.get(0)!=f.opt.$el.get(0)&&(n=$.extend(e.getNodeStyle(t),n),t.parentsUntil(f.opt.$el).map(function(){n=$.extend(e.getNodeStyle($(this)),n)})),n}}(),getNodeStyle:function(){return function(e){var t={},n=e.attr("style")||null,i=e.get(0).tagName,o={A:function(){return function(){t.link=e.attr("href"),t.$linkEl=e}}(),OL:function(){return function(){t.insertorderedlist=""}}(),UL:function(){return function(){t.insertunorderedlist=""}}()},r={"font-style":function(){return function(){t.italic=""}}(),"font-weight":function(){return function(){t.bold=""}}(),"text-align":function(){return function(e){"center"==e?t.justifycenter="":"right"==e?t.justifyright="":"justify"==e?t.justifyfull="":"left"==e&&(t.justifyleft="")}}(),"text-decoration":function(){return function(){t.underline=""}}()};if(f.opt.additionalButtons.tags&&$.inArray(i.toLowerCase(),Object.keys(f.opt.additionalButtons.tags))+1&&(t.formatblock=i.toLowerCase()),f.opt.colors&&f.opt.colors.length&&$.inArray(e.attr("class"),f.opt.colors)+1&&(t.forecolor=e.attr("class")),null!=o[i]&&o[i](),null!=n){var l=n.split(";");l.forEach(function(e){if(0<e.length){e=e.replace(/\s/g,"");var t=e.split(":");r[t[0]]&&r[t[0]](t[1])}})}return t}}()},_dialog:{insertVideo:function(){return function(){new d({callBack:function(){return function(e){f._applySelection.video(e)}}()})}}(),link:function(){return function(){var e=null,t=f.opt.$el;f._selection.save(),null!=f._imageControls.$img&&"A"==f._imageControls.$img.parent().get(0).tagName&&(e=f._imageControls.$img.parent().attr("href"),t=f._imageControls.$img.parent()),null!=f._lightControls.getList().link&&(e=f._lightControls.getList().link,t=f._lightControls.getList().$linkEl);var n=t;f._imageControls.$el&&(n=f._imageControls.$el),f._inlineControls.$el.hasClass("editor-visible")&&(n=f._inlineControls.$el),s.open({$targetEl:n,titleShow:!0,title:a("constructor.link"),data:'<div class="ul-editor-link UL ul-sp"></div>',showApplyBtn:!1,showCloseBtn:!1,wide:!1,afterOpen:function(){return function(){f._selection.clear(),l.open({$renderedTo:$(".ul-editor-link"),href:e,target:null!=t.attr("target"),applyLink:function(){return function(e){e.noClose&&f._applySelection.link(e.link,e.target)}}()})}}(),beforeClose:function(){return function(){l.close()}}()})}}(),image:function(){return function(){i.open({multiSelect:!1,apply:function(){return function(e){f._selection.restore(),f._applySelection.image({src:e[0].origin})}}()})}}(),crop:function(){return function(){var e=null==f._imageControls.$img?null:f._imageControls.$img.attr("src");o.open({img:e,done:function(){return function(e){f._selection.restore(),f._applySelection.image({src:e.data})}}()})}}()},_selection:{getFocusNode:function(){return function(){return null!=window.getSelection().focusNode?$(window.getSelection().focusNode).parent()||null:void 0}}(),getSelected:function(){return function(){var e;if(window.getSelection){var t=window.getSelection();t.getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0))}else document.selection&&document.selection.createRange&&(e=document.selection.createRange());return e}}(),save:function(){return function(){this.selected=this.getSelected()}}(),restore:function(){return function(){if(this.selected)if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.addRange(this.selected)}else document.selection&&this.selected&&this.selected.select();this.selected=null}}(),clear:function(){return function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}}(),setNodeSelecton:function(){return function(e){var t=document.createRange();t.selectNode(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}}()}};return f});
//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map
